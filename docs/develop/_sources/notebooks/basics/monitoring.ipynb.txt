{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "8f574f16",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "26fbdb97",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:44.143971Z",
     "iopub.status.busy": "2022-05-09T15:53:44.143728Z",
     "iopub.status.idle": "2022-05-09T15:53:47.249092Z",
     "shell.execute_reply": "2022-05-09T15:53:47.248520Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-09 15:53:45.141631: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-09 15:53:45.141661: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "95b04350",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "43a4df76",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.251941Z",
     "iopub.status.busy": "2022-05-09T15:53:47.251725Z",
     "iopub.status.idle": "2022-05-09T15:53:47.254542Z",
     "shell.execute_reply": "2022-05-09T15:53:47.254056Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "27c2934e",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "96869659",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.257155Z",
     "iopub.status.busy": "2022-05-09T15:53:47.256969Z",
     "iopub.status.idle": "2022-05-09T15:53:47.259515Z",
     "shell.execute_reply": "2022-05-09T15:53:47.259118Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "3b49826e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.261989Z",
     "iopub.status.busy": "2022-05-09T15:53:47.261804Z",
     "iopub.status.idle": "2022-05-09T15:53:47.369921Z",
     "shell.execute_reply": "2022-05-09T15:53:47.369383Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fc3019f21a0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "058e0d07",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.373111Z",
     "iopub.status.busy": "2022-05-09T15:53:47.372855Z",
     "iopub.status.idle": "2022-05-09T15:53:47.422333Z",
     "shell.execute_reply": "2022-05-09T15:53:47.421880Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-09 15:53:47.375099: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-09 15:53:47.375127: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-09 15:53:47.375145: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (bbdf7c7ebd7a): /proc/driver/nvidia/version does not exist\n",
      "2022-05-09 15:53:47.375404: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fc3017e2920&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fc3017e2920>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "bdb40b5b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.424660Z",
     "iopub.status.busy": "2022-05-09T15:53:47.424421Z",
     "iopub.status.idle": "2022-05-09T15:53:47.586642Z",
     "shell.execute_reply": "2022-05-09T15:53:47.586056Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5a623857",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "3463a4c3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.590151Z",
     "iopub.status.busy": "2022-05-09T15:53:47.589867Z",
     "iopub.status.idle": "2022-05-09T15:53:47.606222Z",
     "shell.execute_reply": "2022-05-09T15:53:47.605782Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5a57f5d1",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "d22c04ad",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.608764Z",
     "iopub.status.busy": "2022-05-09T15:53:47.608555Z",
     "iopub.status.idle": "2022-05-09T15:53:47.611741Z",
     "shell.execute_reply": "2022-05-09T15:53:47.611306Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "edd20e0f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:47.613655Z",
     "iopub.status.busy": "2022-05-09T15:53:47.613471Z",
     "iopub.status.idle": "2022-05-09T15:53:54.024977Z",
     "shell.execute_reply": "2022-05-09T15:53:54.024455Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-09 15:53:47.618298: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "329c20d8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "35b4ffe4",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "cde5b428",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:54.027986Z",
     "iopub.status.busy": "2022-05-09T15:53:54.027769Z",
     "iopub.status.idle": "2022-05-09T15:53:54.032923Z",
     "shell.execute_reply": "2022-05-09T15:53:54.032504Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "98b52d7f",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "f7f1bbf6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:54.035331Z",
     "iopub.status.busy": "2022-05-09T15:53:54.035142Z",
     "iopub.status.idle": "2022-05-09T15:53:56.175102Z",
     "shell.execute_reply": "2022-05-09T15:53:56.174435Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8759431e",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f907d038",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "f4728529",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:56.178595Z",
     "iopub.status.busy": "2022-05-09T15:53:56.178269Z",
     "iopub.status.idle": "2022-05-09T15:53:56.202353Z",
     "shell.execute_reply": "2022-05-09T15:53:56.201882Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "ff5801dc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-09T15:53:56.204861Z",
     "iopub.status.busy": "2022-05-09T15:53:56.204654Z",
     "iopub.status.idle": "2022-05-09T15:53:58.217157Z",
     "shell.execute_reply": "2022-05-09T15:53:58.216686Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "eff70d05",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
