{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "289507f6",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "c4a09875",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:40.114257Z",
     "iopub.status.busy": "2022-06-01T13:20:40.113840Z",
     "iopub.status.idle": "2022-06-01T13:20:43.205865Z",
     "shell.execute_reply": "2022-06-01T13:20:43.205182Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-01 13:20:41.081779: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-01 13:20:41.081808: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "24d2efaa",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "ee054845",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.208762Z",
     "iopub.status.busy": "2022-06-01T13:20:43.208338Z",
     "iopub.status.idle": "2022-06-01T13:20:43.211453Z",
     "shell.execute_reply": "2022-06-01T13:20:43.210941Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a4cbe942",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "35b3d575",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.214102Z",
     "iopub.status.busy": "2022-06-01T13:20:43.213805Z",
     "iopub.status.idle": "2022-06-01T13:20:43.216642Z",
     "shell.execute_reply": "2022-06-01T13:20:43.216151Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "9f83501c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.218772Z",
     "iopub.status.busy": "2022-06-01T13:20:43.218545Z",
     "iopub.status.idle": "2022-06-01T13:20:43.310846Z",
     "shell.execute_reply": "2022-06-01T13:20:43.310288Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fe4e40a1d80>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAXwAAAD4CAYAAADvsV2wAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8qNh9FAAAACXBIWXMAAAsTAAALEwEAmpwYAAAYu0lEQVR4nO3dfYxc5XXH8d/xeoCFVFkSVklYMLZSZAohwcqKEFmqikNk8gJ2yAukaRXaVP4nqE1abbUoUTH5B1dWm0QKaoRIFKKiQAJkMTKV82JXSLRErLNQMODUIg14QhsnsLTBSzxen/6xM/bszL0zd/a+zb33+5EQOzN39z6TlzPPnOc85zF3FwCg/FblPQAAQDYI+ABQEQR8AKgIAj4AVAQBHwAqYnXeAwhzzjnn+Nq1a/MeBgAUyv79+3/t7uNBrw1twF+7dq1mZ2fzHgYAFIqZ/SLsNVI6AFARBHwAqAgCPgBUBAEfACqCgA8AFTG0VToAim1mrq6dew7ql/MLOndsVFOb12vrhom8h1VpBHwAiZuZq+vmB57SQmNRklSfX9DNDzwlSQT9HJHSAZC4nXsOngz2LQuNRe3cczCnEUEi4ANIwS/nFwZ6Htkg4ANI3LljowM9j2wQ8AEkbmrzeo3WRpY9N1ob0dTm9TmNCBKLtgBS0FqYDarSoXonPwR8AKnYumGiK5BTvZMvAj6ALmnNwntV7xDw00fAB7BMmrPwsCqd+vyCNu7YS5onZSzaAlgmzRr6sCod01LQd536gJmZq8e+H5Zjhg9A0qk0Tj3FGvqpzeuXfXuQloK9d1w3SJqnfdwjZlp01wTfEgIR8AF0pXGCJFFDH1S9E/YBE/Z8u85xL7qf/F0Wg7sR8AEEpnHajdZGdOVF44nk2Turd95+88MnA3W7EbNY42YxuBsBH0DPdM3E2KiuvGhc9++vp7KQGxTsez3frl+aiVYOy7FoCyA0XTMxNqpHpzdp33NHUlvIPfvMWui9++mXZnJJG3fsZQG4iYAPoG8rhLSaoc3M1fXb1493PV8bsUhtGKY2r1dtVe/UzyBVPzNzdW3csVfrpneX8oOCgA9AWzdM6LbrLtXE2KhMS7Pr26679GS6plcztDhBcueeg2qc6E7dnHXa6kipoq0bJvSGM/pnpqN8G2ktAJe5PJQcPgBJwa0QWoLKKVsLuXE2aYV9Q3h1oRF53PNHo13b79tIFXYBM8MH0FfYN4C4uf0k2ihHvbbfdVXo4U/ABxDJ1g0TenR6k36+40N6dHqTtm6YiB0kk2ijHPQ3OkX5m1Xo4U9KByiYpHeWxmmUFrZxKkqQbN13obEY630Ebea68qJx7XvuyEDvKSxtVaYe/okEfDP7pqQPS/qVu78j4HWT9FVJH5R0VNKN7v7TJO4NVEnSO0vjNkpbaZAMeh+t30tiM9dK9OrhXxZJzfC/Jelrkr4d8voHJF3Y/Oc9kv6p+W8AA0h6Z2nchcrWNdt3HdB8c6F1obGo7bsOLHs96fumJYkPjmGWSA7f3R+R9HKPS7ZI+rYveUzSmJm9LYl7A1WS9M7SpBYqXzu2vJZ+fqGhqe89GVrSWIUF0mGUVQ5/QtKLbY8PN597qf0iM9smaZskrVmzJqOhAcXRq9lY6/Uk/t4qM62b3h2a1mjP+69q5t87NU546Iw9Tu4fKzdUVTrufoe7T7r75Pj4eN7DAYZOv9z4oAuMYRUui+6hm486Nyj16nkTNmMf5kPOy7zbNquAX5d0ftvj85rPARjA1g0Tob1nzj6zNnD+ubO+PqhDZWddfb/Omu3CZuz9dvbmpey7bbNK6eySdJOZ3aOlxdpX3f2lPr8DIMAt11wSWBlzyzWXrOjvtS9UrpveHXhN+0w9ap69tqp3P5xhXCAd1sXkpCRVlvkdSX8k6RwzOyzpFkk1SXL3r0t6WEslmYe0VJb5Z0ncF6iiNMsHo+TWw/P+UqstzthoTduvvaRwQbLsi8mJBHx3/2Sf113SZ5O4F4D4s+OwzVZR6urDrhmGlExcZV9MZqctUADtAfqNozWZLTUNW8nsPspmq17fHsq8Qansu23NI5wqk4fJyUmfnZ3NexhA7vqdNzvo7Hrjjr2Bs9jWYSdVF6fVxDAws/3uPhn0GjN8YMj1q4oZdFGx7HnquIZxMTkpQ1WHD6Bbr41W7ddErRuvQldIBCPgAxkbZGPPzFxdvQ/wO6VVN/75e5/QF2eeCr1umDc9IV0EfCBDQRt7egXonXsOatBVNpd092MvhH6QDOumJ6SPHD6QoVsfOtCVj28F6MkL3tQVdFeaV3epZ16/zHnqLBVtgZcZPpCRmbm6Xgk5f7UVoDuF5dVHzPSV6y/T2GhwmwWJRdi0FbENAwEfyEi/c16DAnRYvv0fPvEuSd1tiduxCJuuXm0YhhUpHSAj/WbcQQG61yanjTv2qrEYnOFnETZ9RSxvJeADGenVy75XgA7Lt/cKLCzCpq+IbRhI6QAZCes9PzZaGzhAz8zVtSqglbG0VHVDsE9fEctbmeEDGUmqB01rsTDs4JGjx45rZq5O0E9ZEXsK0UsHyMlKS/rCeuG0K0v3SgyuVy8dUjpADuKU9EVZFBz2ahHkg4AP5CCspO9z9z7Rt93CWMgRh52GuVqkiMpw1i05fCAHvYJxUH/6dlGzsMNcLVI0Uc4QKAICPpCyoFx9rxJNaXlKpvN3X10I3q3bbtirRYqmLGfdsmgLpCjo8JLaKtNpq1fptWPhPe5bRmsjXacvnb56leYDgv6ImU64F6JapGjWTe8ObGJnkn6+40NZD6cnDkABchI0M2yccDUiBPsRs8BZ5Rm1VYEfBFTlpKeIm6yCsGgLpCjqwmnnFqrR2khonf380QbtjTNWxE1WQZjhAynql6tvcS0F7vZc/c49B0NnlbQ3zlbrP+vtuw6cTKedUSvefJmAD6RoavP6ngeQt4QdIN75u0WcVZbJ746fOPnzK0cbhavUKd5HFFAgnadLjY3WVBtZnsAJC+KcTDVcitgOuRMzfGAFerVFaH9t7Mya3KVXFxonr5Oi918hdTM8itgOuRMzfGBAvdoidL72ytGG5hcay66TpEenN+nL118mSfp8hN21yF9YRU4SlTpZ7eJlhg8MqN9X+175+vbryrBzs0qC1mOSWFPJchcvM3xgQL2+2kf5el+fXwj90Ni+60AiY0Ty0lpTyXJtgBk+MKB+m3D6lWGOmIV+MMwvNOhlP8TSWFPJcm2AGT4woF6bcMJOtWq32Gx/EKZIVR+IL821gU4EfGBAvb7at78WZqKtWidIkao+EF+Wu3gTSemY2dWSvippRNKd7r6j4/UbJe2U1Fp6/pq735nEvYE89Ppq33ptZq6uqfueVGPxVIuE2oidLMO89aEDeuVodxO0ovVnQTxZHpUYO+Cb2Yik2yW9X9JhSY+b2S53f6bj0nvd/aa49wOyttKjCCWpq8Vi2+NbrrmEnbSQlN1+iyRSOpdLOuTuz7v7MUn3SNqSwN8FchfnKMKdew6qcWJ5xG+c8JM5enbSImtJpHQmJL3Y9viwpPcEXPdRM/tDST+T9Hl3f7HzAjPbJmmbJK1ZsyaBoQHxDHLwRec3gbBqnfYcPTtpkaWsFm0fkrTW3d8p6YeS7gq6yN3vcPdJd58cHx/PaGhAuKglc0HfBDpbHreQo0dekgj4dUnntz0+T6cWZyVJ7v4bd/9d8+Gdkt6dwH2B1EUtmQv6JuAK7nNPjh55SSLgPy7pQjNbZ2anSbpB0q72C8zsbW0Pr5X0bAL3BVIXtWQu7JtAq889OXoMg9g5fHc/bmY3SdqjpbLMb7r7ATP7kqRZd98l6S/N7FpJxyW9LOnGuPcFshC1ZC4sZx/W5x7IA4eYAwkIOqycc2aRBw4xB1KW5eYZYKUI+EBCKLFEXLE2+UVAwAeAIZBFX3yapwHAEMiiLz4BHwCGQBZ98UnpAH2knVcFpP4H6ySBGT4qKeqh0XGapwGDyKIvPgEflTNIEM/yvFFUWxbdU0npoHIG6YCZ5XmjQNqlvczwUTmDBPGxM2uB164yI62DwiHgo3KidsCcmavrt68fD7x20Z1cPgqHgI/Kibo4FnRiVTty+SgacvionKh9b8JOrGpHLh9FQsBHJfVbHJuZq8vUfQZ5J06vQpGQ0gEC7NxzsG+w5/QqFA0zfCBAr1SNSey4RSER8FE6SbRC4AQrlBEpHZRKUq0QstjmDmSNGT5KpV8rhKgzf06wQhlxpi1KZd307tDF1tHaCGfOovR6nWlLSgelElYmOWJGEzRUHgEfpRKUe6+tMi2GfJOtzy9EbpUMFB05fJRKZ+79jaM1vXYsuB9Oy9R9T6qxuPSBkMY5osCwYIaP0tm6YUKPTm/Sz3d8SGedvvpkMA/T+TqpHpQVAR+lttJeN/TIQRkR8FFqK+11E9YHHygyAj5KLWgRN4rfvn6cxVuUDgEfpdZ5TujZZ9Zk1v/3GiecPD5KhyodlF5nK+R107sj/R55fJQNM3xUTtS8Pr3uUTYEfFTO1Ob1qo30zuvQKA1llEjAN7OrzeygmR0ys+mA1083s3ubr//EzNYmcV9gJbZumNDOj71LZ7dV4ozWVi3l97XUApkeOyij2Dl8MxuRdLuk90s6LOlxM9vl7s+0XfYZSa+4+++b2Q2S/l7S9XHvDaxUvyMOgTJKYoZ/uaRD7v68ux+TdI+kLR3XbJF0V/Pn+yS9zyxKrQQAIClJBPwJSS+2PT7cfC7wGnc/LulVSW/u/ENmts3MZs1s9siRIwkMDQDQMlSLtu5+h7tPuvvk+Ph43sMBgFJJog6/Lun8tsfnNZ8Luuawma2W9EZJv0ng3kBkSZx1CxRZEjP8xyVdaGbrzOw0STdI2tVxzS5Jn27+/DFJe31Yj9pCKSV11i1QZLEDfjMnf5OkPZKelfRddz9gZl8ys2ubl31D0pvN7JCkv5bUVboJpKnfWbdAFSTSWsHdH5b0cMdzf9f28+uSPp7EvYCVCGuTQPsEVMlQLdoCaQlrk0D7BFQJzdNQOkGLs1Ob1+vmB55altahfQKqhhk+SiVscVbSsjbJtE9AFTHDR6n0Wpx9dHoTAR6VxgwfpcLiLBCOGT6GUmce/sqLxrXvuSN9N02dOzaqekBwZ3EWIOBjCLXy8K3UTH1+Qf/82AsnX2/Py0vq+mC4f3+dxVkgAAEfQycoD99pobGo7bsO6HfHTyz7YLh/f10fffdEpG8DQNUQ8DF0oubb5xcaXc8tNBa177kjenR6U9LDAgqPRVsMnbj5dhZogWAEfAydqc3rNVob6XnNaG1k2RGF7VigBYIR8DF0tm6Y6Nok9SdXrOnaNHXLNZd0fTCwQAuEI4ePoTTImbP0uAeiIeCjEMIOL+EwciA6Aj5y1+8kqqC6/FYdPsEeiI4cPnIV5SSqsP44n7v3CW3csZdTq4CICPjIVZSTqHqVWXJUIRAdAR+5mZmrB/a9kZYH+X5llhxVCERDwEcuWqmcMO1BPkpdPputgP5YtEVqei3G9uqX01lL3/47Yd8I2GwF9EfARyrCKmtmf/Gy9j13JDRwSwo8iapVftn5dyU2WwFREfCRirDF2Lsfe0He4/cmxkZ7llq2z/bZbAUMhoCPVITl1HsF+6gzdTZbASvDoi1SMWhOnUPFgfQR8JGKoMoaC7l2YmyUA8aBDBDwkYqgjpefumIN3S2BHJHDR2qCcu2TF7yJBVcgJwR8ZIoFVyA/pHQAoCKY4SNT/VohA0hPrIBvZm+SdK+ktZL+S9In3P2VgOsWJbUap7zg7tfGuS+Kib72QL7ipnSmJf3Y3S+U9OPm4yAL7n5Z8x+CfUVFaYUMID1xA/4WSXc1f75L0taYfw8lFrb7lk6XQDbiBvy3uPtLzZ//W9JbQq47w8xmzewxM9sa854oqLDdt2biABMgA30Dvpn9yMyeDvhnS/t17u4Kb5VygbtPSvpjSV8xs7eH3Gtb84Nh9siRI4O+Fwy5qc3rVRvp3m97wqWp+54k6AMp6xvw3f0qd39HwD8PSvofM3ubJDX//auQv1Fv/vt5Sf8qaUPIdXe4+6S7T46Pj6/wLWFYbd0wobNOC64TaCw6uXwgZXFTOrskfbr586clPdh5gZmdbWanN38+R9JGSc/EvC8K6tWFRuhr5PKBdMUN+Dskvd/M/lPSVc3HMrNJM7uzec0fSJo1sycl7ZO0w90J+BXVq4smp1YB6YpVh+/uv5H0voDnZyX9RfPnf5N0aZz7oDymNq/X1PeeVOPE8uWe2ojRRA1IGTttkanWBqvtuw5ovpneOfvMmm655hI2XwEpI+AjczRQA/JB8zQAqAgCPgBUBAEfACqCgA8AFUHAB4CKIOADQEUQ8AGgIqjDR2wcWwgUAwEfsXBsIVAcpHQQC8cWAsXBDB+RBaVuOLYQKA5m+Iiklbqpzy/IdSp1M3ZmLfD6VWacYAUMGQI+IglL3bhLo7WRrusX3XXzA08R9IEhQsBHJGEpmlcXGrrtuks1Yt1n1ZLLB4YLAR+RhJ1Gde7YqLZumNAJDz6/nlw+MDwI+IjkyovG1TmHH62NnDylqtcHAoDhQMBHXzNzdd2/v672ObxJ+ui7Tx1kMrV5fVcuv/0DAUD+KMtEqFYZZj0gLeOS9j135OTjVuBnxy0wvAj4CNS5gzZIZ36eowuB4UbAr5BBet4ElWF2Ij8PFAsBvyIG7XkTlMZpR34eKB4WbStikJ43M3P1roqcdhNjo7rtuktJ3wAFwwy/IgbpebNzz0EFVdWbpC9ffxmBHigoZvgVMUidfNiHg4uWx0CRlS7gz8zVtXHHXq2b3q2NO/bSy6VpkDr5sA+HCRZpgUIrVcAP6+hI0F+amd923aWaGBuVqXcenk1UQDmVKoffa2GyyqmIznLMfnl4NlEB5VSqgM9hHN1WegQhm6iA8ilVSocGXt04ghBAS6yAb2YfN7MDZnbCzCZ7XHe1mR00s0NmNh3nnr2Qe+7Gtx4ALXFn+E9Luk7SI2EXmNmIpNslfUDSxZI+aWYXx7xvoEEWJquCbz0AWmLl8N39WUmygNOO2lwu6ZC7P9+89h5JWyQ9E+feYcg9Lze1eX1XE7Sqf+sBqiqLRdsJSS+2PT4s6T0Z3Bei4gbAKX0Dvpn9SNJbA176grs/mORgzGybpG2StGbNmiT/dKEN0uUyCN96AEgRAr67XxXzHnVJ57c9Pq/5XNC97pB0hyRNTk4GH5JaMV+ceUp3P/bCyd42UcsqAaBTFmWZj0u60MzWmdlpkm6QtCuD+xbezFx9WbBvoawSwErELcv8iJkdlvReSbvNbE/z+XPN7GFJcvfjkm6StEfSs5K+6+4H4g27GsK6VkqUVQIYXNwqne9L+n7A87+U9MG2xw9LejjOvaqoV1CnrBLAoEq107ZswoK6SZRVAhgYAT9lcdo1B+0cNkmfumINC7YABlaq5mnDZqWNy1p61dDHLdUEUD0E/BQl0a45qIY+7gcJgGoipZOitBqXhX2Q3PoQxU8AwhHwU5RW47KwD4xXjjY43QtAKAJ+itJq19zrA4MNWQDCEPBTlFa75l4fGGzIAhDG3IezZc3k5KTPzs7mPYyhddmtP9D8QqPr+bHRms46fTXVO0BFmdl+dw88kIoZfkFtv/aSrnRRbZXptWPHVZ9fkOtU9Q55fQASAb+wgtJFbzhjtRqLy7+x0WgNQAt1+AXWWaO/bnp34HXk9QFIzPBLhfNrAfRCwC+RtMpAAZQDKZ0S4fxaAL0Q8EuG82sBhCGlAwAVQcAHgIog4ANARRDwAaAiCPgAUBFD2zzNzI5I+kXe40jIOZJ+nfcgcsJ7rybee34ucPfxoBeGNuCXiZnNhnWvKzveO++9aob5vZPSAYCKIOADQEUQ8LNxR94DyBHvvZp470OIHD4AVAQzfACoCAI+AFQEAT8DZrbTzJ4zs/8ws++b2VjeY8qKmX3czA6Y2QkzG8pStaSZ2dVmdtDMDpnZdN7jyZKZfdPMfmVmT+c9lqyZ2flmts/Mnmn+b/6v8h5TJwJ+Nn4o6R3u/k5JP5N0c87jydLTkq6T9EjeA8mCmY1Iul3SByRdLOmTZnZxvqPK1LckXZ33IHJyXNLfuPvFkq6Q9Nlh+++egJ8Bd/+Bux9vPnxM0nl5jidL7v6su1fpFPXLJR1y9+fd/ZikeyRtyXlMmXH3RyS9nPc48uDuL7n7T5s//5+kZyUN1eEUBPzs/bmkf8l7EEjNhKQX2x4f1pD9nx7pM7O1kjZI+knOQ1mGE68SYmY/kvTWgJe+4O4PNq/5gpa+9t2d5djSFuW9A1VhZm+QdL+kz7n7/+Y9nnYE/IS4+1W9XjezGyV9WNL7vGSbH/q994qpSzq/7fF5zedQAWZW01Kwv9vdH8h7PJ1I6WTAzK6W9LeSrnX3o3mPB6l6XNKFZrbOzE6TdIOkXTmPCRkwM5P0DUnPuvs/5j2eIAT8bHxN0u9J+qGZPWFmX897QFkxs4+Y2WFJ75W028z25D2mNDUX52+StEdLi3bfdfcD+Y4qO2b2HUn/Lmm9mR02s8/kPaYMbZT0p5I2Nf9//oSZfTDvQbWjtQIAVAQzfACoCAI+AFQEAR8AKoKADwAVQcAHgIog4ANARRDwAaAi/h/ue4J1BeDpogAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "1758cefc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.313417Z",
     "iopub.status.busy": "2022-06-01T13:20:43.313138Z",
     "iopub.status.idle": "2022-06-01T13:20:43.361634Z",
     "shell.execute_reply": "2022-06-01T13:20:43.360908Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-01 13:20:43.315323: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-01 13:20:43.315350: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-01 13:20:43.315370: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (2d34b22a3c46): /proc/driver/nvidia/version does not exist\n",
      "2022-06-01 13:20:43.315629: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fe4e40fe620&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fe4e40fe620>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "43d32d47",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.364388Z",
     "iopub.status.busy": "2022-06-01T13:20:43.364119Z",
     "iopub.status.idle": "2022-06-01T13:20:43.506833Z",
     "shell.execute_reply": "2022-06-01T13:20:43.506249Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ca910f36",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "c9ade34d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.509611Z",
     "iopub.status.busy": "2022-06-01T13:20:43.509333Z",
     "iopub.status.idle": "2022-06-01T13:20:43.524657Z",
     "shell.execute_reply": "2022-06-01T13:20:43.524115Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a4fa4f1c",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "f5b22054",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.527597Z",
     "iopub.status.busy": "2022-06-01T13:20:43.527336Z",
     "iopub.status.idle": "2022-06-01T13:20:43.530820Z",
     "shell.execute_reply": "2022-06-01T13:20:43.530322Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "244a84a9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:43.533166Z",
     "iopub.status.busy": "2022-06-01T13:20:43.532921Z",
     "iopub.status.idle": "2022-06-01T13:20:51.419308Z",
     "shell.execute_reply": "2022-06-01T13:20:51.418662Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-01 13:20:43.537690: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8fe19fc5",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "04d42ecd",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "dc61b620",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:51.451135Z",
     "iopub.status.busy": "2022-06-01T13:20:51.450809Z",
     "iopub.status.idle": "2022-06-01T13:20:51.455918Z",
     "shell.execute_reply": "2022-06-01T13:20:51.455387Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "da96e8de",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "9dfa5e82",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:51.458432Z",
     "iopub.status.busy": "2022-06-01T13:20:51.458180Z",
     "iopub.status.idle": "2022-06-01T13:20:53.502922Z",
     "shell.execute_reply": "2022-06-01T13:20:53.502203Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "22a1fa73",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4a580008",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "efef8b71",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:53.506095Z",
     "iopub.status.busy": "2022-06-01T13:20:53.505833Z",
     "iopub.status.idle": "2022-06-01T13:20:53.521886Z",
     "shell.execute_reply": "2022-06-01T13:20:53.521245Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "6f130ac5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T13:20:53.524478Z",
     "iopub.status.busy": "2022-06-01T13:20:53.524235Z",
     "iopub.status.idle": "2022-06-01T13:20:55.298105Z",
     "shell.execute_reply": "2022-06-01T13:20:55.297543Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fc6e442c",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
