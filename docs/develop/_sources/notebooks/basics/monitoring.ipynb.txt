{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "2d77f07a",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "707357be",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:09.612032Z",
     "iopub.status.busy": "2022-06-01T10:45:09.611737Z",
     "iopub.status.idle": "2022-06-01T10:45:12.628176Z",
     "shell.execute_reply": "2022-06-01T10:45:12.627598Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-01 10:45:10.517164: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-01 10:45:10.517192: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d13212e6",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "29fba47e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.630925Z",
     "iopub.status.busy": "2022-06-01T10:45:12.630520Z",
     "iopub.status.idle": "2022-06-01T10:45:12.633553Z",
     "shell.execute_reply": "2022-06-01T10:45:12.633074Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1dfc9518",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "0e7611a5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.635905Z",
     "iopub.status.busy": "2022-06-01T10:45:12.635658Z",
     "iopub.status.idle": "2022-06-01T10:45:12.638415Z",
     "shell.execute_reply": "2022-06-01T10:45:12.637932Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "227d9c0c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.640604Z",
     "iopub.status.busy": "2022-06-01T10:45:12.640258Z",
     "iopub.status.idle": "2022-06-01T10:45:12.755203Z",
     "shell.execute_reply": "2022-06-01T10:45:12.754627Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f6418521de0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "7d3cb7d3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.757827Z",
     "iopub.status.busy": "2022-06-01T10:45:12.757529Z",
     "iopub.status.idle": "2022-06-01T10:45:12.805439Z",
     "shell.execute_reply": "2022-06-01T10:45:12.804899Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-01 10:45:12.759760: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-01 10:45:12.759789: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-01 10:45:12.759806: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (01f7e3379066): /proc/driver/nvidia/version does not exist\n",
      "2022-06-01 10:45:12.760059: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f64185761d0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f64185761d0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "ac81261b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.808100Z",
     "iopub.status.busy": "2022-06-01T10:45:12.807840Z",
     "iopub.status.idle": "2022-06-01T10:45:12.964208Z",
     "shell.execute_reply": "2022-06-01T10:45:12.963634Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d450baf8",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "1e4b20b0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.966913Z",
     "iopub.status.busy": "2022-06-01T10:45:12.966636Z",
     "iopub.status.idle": "2022-06-01T10:45:12.981966Z",
     "shell.execute_reply": "2022-06-01T10:45:12.981404Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "46187cf4",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "a37fb075",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.984631Z",
     "iopub.status.busy": "2022-06-01T10:45:12.984377Z",
     "iopub.status.idle": "2022-06-01T10:45:12.987698Z",
     "shell.execute_reply": "2022-06-01T10:45:12.987207Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "93c12f13",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:12.989916Z",
     "iopub.status.busy": "2022-06-01T10:45:12.989656Z",
     "iopub.status.idle": "2022-06-01T10:45:20.984692Z",
     "shell.execute_reply": "2022-06-01T10:45:20.984063Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-01 10:45:12.994293: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "328c4955",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4a35263a",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "711b192a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:21.011620Z",
     "iopub.status.busy": "2022-06-01T10:45:21.011295Z",
     "iopub.status.idle": "2022-06-01T10:45:21.016327Z",
     "shell.execute_reply": "2022-06-01T10:45:21.015815Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "16d1e3cb",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "4a32369c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:21.019029Z",
     "iopub.status.busy": "2022-06-01T10:45:21.018795Z",
     "iopub.status.idle": "2022-06-01T10:45:23.081118Z",
     "shell.execute_reply": "2022-06-01T10:45:23.080494Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "53431445",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "37497d19",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "686dd9a4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:23.084439Z",
     "iopub.status.busy": "2022-06-01T10:45:23.084158Z",
     "iopub.status.idle": "2022-06-01T10:45:23.100328Z",
     "shell.execute_reply": "2022-06-01T10:45:23.099770Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "3ecfb91d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-01T10:45:23.103129Z",
     "iopub.status.busy": "2022-06-01T10:45:23.102865Z",
     "iopub.status.idle": "2022-06-01T10:45:24.876156Z",
     "shell.execute_reply": "2022-06-01T10:45:24.875579Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "71a7aeec",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
