{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "b56fa839",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "5e5c9fdb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:25.052807Z",
     "iopub.status.busy": "2022-05-10T14:34:25.052535Z",
     "iopub.status.idle": "2022-05-10T14:34:27.878152Z",
     "shell.execute_reply": "2022-05-10T14:34:27.877641Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-10 14:34:25.919293: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-10 14:34:25.919321: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b60174c7",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "09877525",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:27.880681Z",
     "iopub.status.busy": "2022-05-10T14:34:27.880247Z",
     "iopub.status.idle": "2022-05-10T14:34:27.883103Z",
     "shell.execute_reply": "2022-05-10T14:34:27.882689Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "78e9b573",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "64efbb1e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:27.885185Z",
     "iopub.status.busy": "2022-05-10T14:34:27.884953Z",
     "iopub.status.idle": "2022-05-10T14:34:27.887474Z",
     "shell.execute_reply": "2022-05-10T14:34:27.887081Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "5ebf4687",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:27.889578Z",
     "iopub.status.busy": "2022-05-10T14:34:27.889275Z",
     "iopub.status.idle": "2022-05-10T14:34:27.978537Z",
     "shell.execute_reply": "2022-05-10T14:34:27.978077Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f2340450af0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "998fa046",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:27.980679Z",
     "iopub.status.busy": "2022-05-10T14:34:27.980434Z",
     "iopub.status.idle": "2022-05-10T14:34:28.026037Z",
     "shell.execute_reply": "2022-05-10T14:34:28.025590Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-10 14:34:27.982472: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-10 14:34:27.982503: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-10 14:34:27.982523: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (527a5c4f1609): /proc/driver/nvidia/version does not exist\n",
      "2022-05-10 14:34:27.982774: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f23404a1390&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f23404a1390>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "3267fc58",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:28.028316Z",
     "iopub.status.busy": "2022-05-10T14:34:28.028054Z",
     "iopub.status.idle": "2022-05-10T14:34:28.174147Z",
     "shell.execute_reply": "2022-05-10T14:34:28.173658Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "02d6ebb2",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "6054c2e6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:28.176549Z",
     "iopub.status.busy": "2022-05-10T14:34:28.176294Z",
     "iopub.status.idle": "2022-05-10T14:34:28.191346Z",
     "shell.execute_reply": "2022-05-10T14:34:28.190897Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1b8d5d92",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "e2ddf1c0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:28.193759Z",
     "iopub.status.busy": "2022-05-10T14:34:28.193519Z",
     "iopub.status.idle": "2022-05-10T14:34:28.196593Z",
     "shell.execute_reply": "2022-05-10T14:34:28.196158Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "e7190d5d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:28.198577Z",
     "iopub.status.busy": "2022-05-10T14:34:28.198331Z",
     "iopub.status.idle": "2022-05-10T14:34:33.685751Z",
     "shell.execute_reply": "2022-05-10T14:34:33.685209Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-10 14:34:28.202805: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6a8ddb21",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ec5ad429",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "27bf58b6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:33.688660Z",
     "iopub.status.busy": "2022-05-10T14:34:33.688397Z",
     "iopub.status.idle": "2022-05-10T14:34:33.692955Z",
     "shell.execute_reply": "2022-05-10T14:34:33.692530Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2c3a5c8d",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "c8406692",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:33.695122Z",
     "iopub.status.busy": "2022-05-10T14:34:33.694888Z",
     "iopub.status.idle": "2022-05-10T14:34:35.574858Z",
     "shell.execute_reply": "2022-05-10T14:34:35.574270Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9c5e3335",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a8b090ff",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "c5393d33",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:35.577562Z",
     "iopub.status.busy": "2022-05-10T14:34:35.577300Z",
     "iopub.status.idle": "2022-05-10T14:34:35.592725Z",
     "shell.execute_reply": "2022-05-10T14:34:35.592283Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "02ffc1ea",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T14:34:35.594864Z",
     "iopub.status.busy": "2022-05-10T14:34:35.594627Z",
     "iopub.status.idle": "2022-05-10T14:34:37.302323Z",
     "shell.execute_reply": "2022-05-10T14:34:37.301668Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "efe5dc0b",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
