{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "23c1f012",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3f8475e3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:12.600198Z",
     "iopub.status.busy": "2022-05-10T16:47:12.599931Z",
     "iopub.status.idle": "2022-05-10T16:47:15.618229Z",
     "shell.execute_reply": "2022-05-10T16:47:15.617656Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-10 16:47:13.513917: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-10 16:47:13.513945: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "53ab2281",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "aca19cc8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.620899Z",
     "iopub.status.busy": "2022-05-10T16:47:15.620491Z",
     "iopub.status.idle": "2022-05-10T16:47:15.623676Z",
     "shell.execute_reply": "2022-05-10T16:47:15.623164Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d27add77",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "fb5e4c05",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.625608Z",
     "iopub.status.busy": "2022-05-10T16:47:15.625374Z",
     "iopub.status.idle": "2022-05-10T16:47:15.627941Z",
     "shell.execute_reply": "2022-05-10T16:47:15.627510Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "d739a94a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.629777Z",
     "iopub.status.busy": "2022-05-10T16:47:15.629565Z",
     "iopub.status.idle": "2022-05-10T16:47:15.738883Z",
     "shell.execute_reply": "2022-05-10T16:47:15.738230Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f310ae89870>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAXwAAAD4CAYAAADvsV2wAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8qNh9FAAAACXBIWXMAAAsTAAALEwEAmpwYAAAYu0lEQVR4nO3dfYxc5XXH8d/xeoCFVFkSVklYMLZSZAohwcqKEFmqikNk8gJ2yAukaRXaVP4nqE1abbUoUTH5B1dWm0QKaoRIFKKiQAJkMTKV82JXSLRErLNQMODUIg14QhsnsLTBSzxen/6xM/bszL0zd/a+zb33+5EQOzN39z6TlzPPnOc85zF3FwCg/FblPQAAQDYI+ABQEQR8AKgIAj4AVAQBHwAqYnXeAwhzzjnn+Nq1a/MeBgAUyv79+3/t7uNBrw1twF+7dq1mZ2fzHgYAFIqZ/SLsNVI6AFARBHwAqAgCPgBUBAEfACqCgA8AFTG0VToAim1mrq6dew7ql/MLOndsVFOb12vrhom8h1VpBHwAiZuZq+vmB57SQmNRklSfX9DNDzwlSQT9HJHSAZC4nXsOngz2LQuNRe3cczCnEUEi4ANIwS/nFwZ6Htkg4ANI3LljowM9j2wQ8AEkbmrzeo3WRpY9N1ob0dTm9TmNCBKLtgBS0FqYDarSoXonPwR8AKnYumGiK5BTvZMvAj6ALmnNwntV7xDw00fAB7BMmrPwsCqd+vyCNu7YS5onZSzaAlgmzRr6sCod01LQd536gJmZq8e+H5Zjhg9A0qk0Tj3FGvqpzeuXfXuQloK9d1w3SJqnfdwjZlp01wTfEgIR8AF0pXGCJFFDH1S9E/YBE/Z8u85xL7qf/F0Wg7sR8AEEpnHajdZGdOVF44nk2Turd95+88MnA3W7EbNY42YxuBsBH0DPdM3E2KiuvGhc9++vp7KQGxTsez3frl+aiVYOy7FoCyA0XTMxNqpHpzdp33NHUlvIPfvMWui9++mXZnJJG3fsZQG4iYAPoG8rhLSaoc3M1fXb1493PV8bsUhtGKY2r1dtVe/UzyBVPzNzdW3csVfrpneX8oOCgA9AWzdM6LbrLtXE2KhMS7Pr26679GS6plcztDhBcueeg2qc6E7dnHXa6kipoq0bJvSGM/pnpqN8G2ktAJe5PJQcPgBJwa0QWoLKKVsLuXE2aYV9Q3h1oRF53PNHo13b79tIFXYBM8MH0FfYN4C4uf0k2ihHvbbfdVXo4U/ABxDJ1g0TenR6k36+40N6dHqTtm6YiB0kk2ijHPQ3OkX5m1Xo4U9KByiYpHeWxmmUFrZxKkqQbN13obEY630Ebea68qJx7XvuyEDvKSxtVaYe/okEfDP7pqQPS/qVu78j4HWT9FVJH5R0VNKN7v7TJO4NVEnSO0vjNkpbaZAMeh+t30tiM9dK9OrhXxZJzfC/Jelrkr4d8voHJF3Y/Oc9kv6p+W8AA0h6Z2nchcrWNdt3HdB8c6F1obGo7bsOLHs96fumJYkPjmGWSA7f3R+R9HKPS7ZI+rYveUzSmJm9LYl7A1WS9M7SpBYqXzu2vJZ+fqGhqe89GVrSWIUF0mGUVQ5/QtKLbY8PN597qf0iM9smaZskrVmzJqOhAcXRq9lY6/Uk/t4qM62b3h2a1mjP+69q5t87NU546Iw9Tu4fKzdUVTrufoe7T7r75Pj4eN7DAYZOv9z4oAuMYRUui+6hm486Nyj16nkTNmMf5kPOy7zbNquAX5d0ftvj85rPARjA1g0Tob1nzj6zNnD+ubO+PqhDZWddfb/Omu3CZuz9dvbmpey7bbNK6eySdJOZ3aOlxdpX3f2lPr8DIMAt11wSWBlzyzWXrOjvtS9UrpveHXhN+0w9ap69tqp3P5xhXCAd1sXkpCRVlvkdSX8k6RwzOyzpFkk1SXL3r0t6WEslmYe0VJb5Z0ncF6iiNMsHo+TWw/P+UqstzthoTduvvaRwQbLsi8mJBHx3/2Sf113SZ5O4F4D4s+OwzVZR6urDrhmGlExcZV9MZqctUADtAfqNozWZLTUNW8nsPspmq17fHsq8Qansu23NI5wqk4fJyUmfnZ3NexhA7vqdNzvo7Hrjjr2Bs9jWYSdVF6fVxDAws/3uPhn0GjN8YMj1q4oZdFGx7HnquIZxMTkpQ1WHD6Bbr41W7ddErRuvQldIBCPgAxkbZGPPzFxdvQ/wO6VVN/75e5/QF2eeCr1umDc9IV0EfCBDQRt7egXonXsOatBVNpd092MvhH6QDOumJ6SPHD6QoVsfOtCVj28F6MkL3tQVdFeaV3epZ16/zHnqLBVtgZcZPpCRmbm6Xgk5f7UVoDuF5dVHzPSV6y/T2GhwmwWJRdi0FbENAwEfyEi/c16DAnRYvv0fPvEuSd1tiduxCJuuXm0YhhUpHSAj/WbcQQG61yanjTv2qrEYnOFnETZ9RSxvJeADGenVy75XgA7Lt/cKLCzCpq+IbRhI6QAZCes9PzZaGzhAz8zVtSqglbG0VHVDsE9fEctbmeEDGUmqB01rsTDs4JGjx45rZq5O0E9ZEXsK0UsHyMlKS/rCeuG0K0v3SgyuVy8dUjpADuKU9EVZFBz2ahHkg4AP5CCspO9z9z7Rt93CWMgRh52GuVqkiMpw1i05fCAHvYJxUH/6dlGzsMNcLVI0Uc4QKAICPpCyoFx9rxJNaXlKpvN3X10I3q3bbtirRYqmLGfdsmgLpCjo8JLaKtNpq1fptWPhPe5bRmsjXacvnb56leYDgv6ImU64F6JapGjWTe8ObGJnkn6+40NZD6cnDkABchI0M2yccDUiBPsRs8BZ5Rm1VYEfBFTlpKeIm6yCsGgLpCjqwmnnFqrR2khonf380QbtjTNWxE1WQZjhAynql6tvcS0F7vZc/c49B0NnlbQ3zlbrP+vtuw6cTKedUSvefJmAD6RoavP6ngeQt4QdIN75u0WcVZbJ746fOPnzK0cbhavUKd5HFFAgnadLjY3WVBtZnsAJC+KcTDVcitgOuRMzfGAFerVFaH9t7Mya3KVXFxonr5Oi918hdTM8itgOuRMzfGBAvdoidL72ytGG5hcay66TpEenN+nL118mSfp8hN21yF9YRU4SlTpZ7eJlhg8MqN9X+175+vbryrBzs0qC1mOSWFPJchcvM3xgQL2+2kf5el+fXwj90Ni+60AiY0Ty0lpTyXJtgBk+MKB+m3D6lWGOmIV+MMwvNOhlP8TSWFPJcm2AGT4woF6bcMJOtWq32Gx/EKZIVR+IL821gU4EfGBAvb7at78WZqKtWidIkao+EF+Wu3gTSemY2dWSvippRNKd7r6j4/UbJe2U1Fp6/pq735nEvYE89Ppq33ptZq6uqfueVGPxVIuE2oidLMO89aEDeuVodxO0ovVnQTxZHpUYO+Cb2Yik2yW9X9JhSY+b2S53f6bj0nvd/aa49wOyttKjCCWpq8Vi2+NbrrmEnbSQlN1+iyRSOpdLOuTuz7v7MUn3SNqSwN8FchfnKMKdew6qcWJ5xG+c8JM5enbSImtJpHQmJL3Y9viwpPcEXPdRM/tDST+T9Hl3f7HzAjPbJmmbJK1ZsyaBoQHxDHLwRec3gbBqnfYcPTtpkaWsFm0fkrTW3d8p6YeS7gq6yN3vcPdJd58cHx/PaGhAuKglc0HfBDpbHreQo0dekgj4dUnntz0+T6cWZyVJ7v4bd/9d8+Gdkt6dwH2B1EUtmQv6JuAK7nNPjh55SSLgPy7pQjNbZ2anSbpB0q72C8zsbW0Pr5X0bAL3BVIXtWQu7JtAq889OXoMg9g5fHc/bmY3SdqjpbLMb7r7ATP7kqRZd98l6S/N7FpJxyW9LOnGuPcFshC1ZC4sZx/W5x7IA4eYAwkIOqycc2aRBw4xB1KW5eYZYKUI+EBCKLFEXLE2+UVAwAeAIZBFX3yapwHAEMiiLz4BHwCGQBZ98UnpAH2knVcFpP4H6ySBGT4qKeqh0XGapwGDyKIvPgEflTNIEM/yvFFUWxbdU0npoHIG6YCZ5XmjQNqlvczwUTmDBPGxM2uB164yI62DwiHgo3KidsCcmavrt68fD7x20Z1cPgqHgI/Kibo4FnRiVTty+SgacvionKh9b8JOrGpHLh9FQsBHJfVbHJuZq8vUfQZ5J06vQpGQ0gEC7NxzsG+w5/QqFA0zfCBAr1SNSey4RSER8FE6SbRC4AQrlBEpHZRKUq0QstjmDmSNGT5KpV8rhKgzf06wQhlxpi1KZd307tDF1tHaCGfOovR6nWlLSgelElYmOWJGEzRUHgEfpRKUe6+tMi2GfJOtzy9EbpUMFB05fJRKZ+79jaM1vXYsuB9Oy9R9T6qxuPSBkMY5osCwYIaP0tm6YUKPTm/Sz3d8SGedvvpkMA/T+TqpHpQVAR+lttJeN/TIQRkR8FFqK+11E9YHHygyAj5KLWgRN4rfvn6cxVuUDgEfpdZ5TujZZ9Zk1v/3GiecPD5KhyodlF5nK+R107sj/R55fJQNM3xUTtS8Pr3uUTYEfFTO1Ob1qo30zuvQKA1llEjAN7OrzeygmR0ys+mA1083s3ubr//EzNYmcV9gJbZumNDOj71LZ7dV4ozWVi3l97XUApkeOyij2Dl8MxuRdLuk90s6LOlxM9vl7s+0XfYZSa+4+++b2Q2S/l7S9XHvDaxUvyMOgTJKYoZ/uaRD7v68ux+TdI+kLR3XbJF0V/Pn+yS9zyxKrQQAIClJBPwJSS+2PT7cfC7wGnc/LulVSW/u/ENmts3MZs1s9siRIwkMDQDQMlSLtu5+h7tPuvvk+Ph43sMBgFJJog6/Lun8tsfnNZ8Luuawma2W9EZJv0ng3kBkSZx1CxRZEjP8xyVdaGbrzOw0STdI2tVxzS5Jn27+/DFJe31Yj9pCKSV11i1QZLEDfjMnf5OkPZKelfRddz9gZl8ys2ubl31D0pvN7JCkv5bUVboJpKnfWbdAFSTSWsHdH5b0cMdzf9f28+uSPp7EvYCVCGuTQPsEVMlQLdoCaQlrk0D7BFQJzdNQOkGLs1Ob1+vmB55altahfQKqhhk+SiVscVbSsjbJtE9AFTHDR6n0Wpx9dHoTAR6VxgwfpcLiLBCOGT6GUmce/sqLxrXvuSN9N02dOzaqekBwZ3EWIOBjCLXy8K3UTH1+Qf/82AsnX2/Py0vq+mC4f3+dxVkgAAEfQycoD99pobGo7bsO6HfHTyz7YLh/f10fffdEpG8DQNUQ8DF0oubb5xcaXc8tNBa177kjenR6U9LDAgqPRVsMnbj5dhZogWAEfAydqc3rNVob6XnNaG1k2RGF7VigBYIR8DF0tm6Y6Nok9SdXrOnaNHXLNZd0fTCwQAuEI4ePoTTImbP0uAeiIeCjEMIOL+EwciA6Aj5y1+8kqqC6/FYdPsEeiI4cPnIV5SSqsP44n7v3CW3csZdTq4CICPjIVZSTqHqVWXJUIRAdAR+5mZmrB/a9kZYH+X5llhxVCERDwEcuWqmcMO1BPkpdPputgP5YtEVqei3G9uqX01lL3/47Yd8I2GwF9EfARyrCKmtmf/Gy9j13JDRwSwo8iapVftn5dyU2WwFREfCRirDF2Lsfe0He4/cmxkZ7llq2z/bZbAUMhoCPVITl1HsF+6gzdTZbASvDoi1SMWhOnUPFgfQR8JGKoMoaC7l2YmyUA8aBDBDwkYqgjpefumIN3S2BHJHDR2qCcu2TF7yJBVcgJwR8ZIoFVyA/pHQAoCKY4SNT/VohA0hPrIBvZm+SdK+ktZL+S9In3P2VgOsWJbUap7zg7tfGuS+Kib72QL7ipnSmJf3Y3S+U9OPm4yAL7n5Z8x+CfUVFaYUMID1xA/4WSXc1f75L0taYfw8lFrb7lk6XQDbiBvy3uPtLzZ//W9JbQq47w8xmzewxM9sa854oqLDdt2biABMgA30Dvpn9yMyeDvhnS/t17u4Kb5VygbtPSvpjSV8xs7eH3Gtb84Nh9siRI4O+Fwy5qc3rVRvp3m97wqWp+54k6AMp6xvw3f0qd39HwD8PSvofM3ubJDX//auQv1Fv/vt5Sf8qaUPIdXe4+6S7T46Pj6/wLWFYbd0wobNOC64TaCw6uXwgZXFTOrskfbr586clPdh5gZmdbWanN38+R9JGSc/EvC8K6tWFRuhr5PKBdMUN+Dskvd/M/lPSVc3HMrNJM7uzec0fSJo1sycl7ZO0w90J+BXVq4smp1YB6YpVh+/uv5H0voDnZyX9RfPnf5N0aZz7oDymNq/X1PeeVOPE8uWe2ojRRA1IGTttkanWBqvtuw5ovpneOfvMmm655hI2XwEpI+AjczRQA/JB8zQAqAgCPgBUBAEfACqCgA8AFUHAB4CKIOADQEUQ8AGgIqjDR2wcWwgUAwEfsXBsIVAcpHQQC8cWAsXBDB+RBaVuOLYQKA5m+Iiklbqpzy/IdSp1M3ZmLfD6VWacYAUMGQI+IglL3bhLo7WRrusX3XXzA08R9IEhQsBHJGEpmlcXGrrtuks1Yt1n1ZLLB4YLAR+RhJ1Gde7YqLZumNAJDz6/nlw+MDwI+IjkyovG1TmHH62NnDylqtcHAoDhQMBHXzNzdd2/v672ObxJ+ui7Tx1kMrV5fVcuv/0DAUD+KMtEqFYZZj0gLeOS9j135OTjVuBnxy0wvAj4CNS5gzZIZ36eowuB4UbAr5BBet4ElWF2Ij8PFAsBvyIG7XkTlMZpR34eKB4WbStikJ43M3P1roqcdhNjo7rtuktJ3wAFwwy/IgbpebNzz0EFVdWbpC9ffxmBHigoZvgVMUidfNiHg4uWx0CRlS7gz8zVtXHHXq2b3q2NO/bSy6VpkDr5sA+HCRZpgUIrVcAP6+hI0F+amd923aWaGBuVqXcenk1UQDmVKoffa2GyyqmIznLMfnl4NlEB5VSqgM9hHN1WegQhm6iA8ilVSocGXt04ghBAS6yAb2YfN7MDZnbCzCZ7XHe1mR00s0NmNh3nnr2Qe+7Gtx4ALXFn+E9Luk7SI2EXmNmIpNslfUDSxZI+aWYXx7xvoEEWJquCbz0AWmLl8N39WUmygNOO2lwu6ZC7P9+89h5JWyQ9E+feYcg9Lze1eX1XE7Sqf+sBqiqLRdsJSS+2PT4s6T0Z3Bei4gbAKX0Dvpn9SNJbA176grs/mORgzGybpG2StGbNmiT/dKEN0uUyCN96AEgRAr67XxXzHnVJ57c9Pq/5XNC97pB0hyRNTk4GH5JaMV+ceUp3P/bCyd42UcsqAaBTFmWZj0u60MzWmdlpkm6QtCuD+xbezFx9WbBvoawSwErELcv8iJkdlvReSbvNbE/z+XPN7GFJcvfjkm6StEfSs5K+6+4H4g27GsK6VkqUVQIYXNwqne9L+n7A87+U9MG2xw9LejjOvaqoV1CnrBLAoEq107ZswoK6SZRVAhgYAT9lcdo1B+0cNkmfumINC7YABlaq5mnDZqWNy1p61dDHLdUEUD0E/BQl0a45qIY+7gcJgGoipZOitBqXhX2Q3PoQxU8AwhHwU5RW47KwD4xXjjY43QtAKAJ+itJq19zrA4MNWQDCEPBTlFa75l4fGGzIAhDG3IezZc3k5KTPzs7mPYyhddmtP9D8QqPr+bHRms46fTXVO0BFmdl+dw88kIoZfkFtv/aSrnRRbZXptWPHVZ9fkOtU9Q55fQASAb+wgtJFbzhjtRqLy7+x0WgNQAt1+AXWWaO/bnp34HXk9QFIzPBLhfNrAfRCwC+RtMpAAZQDKZ0S4fxaAL0Q8EuG82sBhCGlAwAVQcAHgIog4ANARRDwAaAiCPgAUBFD2zzNzI5I+kXe40jIOZJ+nfcgcsJ7rybee34ucPfxoBeGNuCXiZnNhnWvKzveO++9aob5vZPSAYCKIOADQEUQ8LNxR94DyBHvvZp470OIHD4AVAQzfACoCAI+AFQEAT8DZrbTzJ4zs/8ws++b2VjeY8qKmX3czA6Y2QkzG8pStaSZ2dVmdtDMDpnZdN7jyZKZfdPMfmVmT+c9lqyZ2flmts/Mnmn+b/6v8h5TJwJ+Nn4o6R3u/k5JP5N0c87jydLTkq6T9EjeA8mCmY1Iul3SByRdLOmTZnZxvqPK1LckXZ33IHJyXNLfuPvFkq6Q9Nlh+++egJ8Bd/+Bux9vPnxM0nl5jidL7v6su1fpFPXLJR1y9+fd/ZikeyRtyXlMmXH3RyS9nPc48uDuL7n7T5s//5+kZyUN1eEUBPzs/bmkf8l7EEjNhKQX2x4f1pD9nx7pM7O1kjZI+knOQ1mGE68SYmY/kvTWgJe+4O4PNq/5gpa+9t2d5djSFuW9A1VhZm+QdL+kz7n7/+Y9nnYE/IS4+1W9XjezGyV9WNL7vGSbH/q994qpSzq/7fF5zedQAWZW01Kwv9vdH8h7PJ1I6WTAzK6W9LeSrnX3o3mPB6l6XNKFZrbOzE6TdIOkXTmPCRkwM5P0DUnPuvs/5j2eIAT8bHxN0u9J+qGZPWFmX897QFkxs4+Y2WFJ75W028z25D2mNDUX52+StEdLi3bfdfcD+Y4qO2b2HUn/Lmm9mR02s8/kPaYMbZT0p5I2Nf9//oSZfTDvQbWjtQIAVAQzfACoCAI+AFQEAR8AKoKADwAVQcAHgIog4ANARRDwAaAi/h/ue4J1BeDpogAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "187f9d6a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.741516Z",
     "iopub.status.busy": "2022-05-10T16:47:15.741195Z",
     "iopub.status.idle": "2022-05-10T16:47:15.792116Z",
     "shell.execute_reply": "2022-05-10T16:47:15.791566Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-10 16:47:15.743657: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-10 16:47:15.743691: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-10 16:47:15.743712: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (e4ac9129cab8): /proc/driver/nvidia/version does not exist\n",
      "2022-05-10 16:47:15.744012: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f310ac89c60&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f310ac89c60>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "5dd666d7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.794329Z",
     "iopub.status.busy": "2022-05-10T16:47:15.794067Z",
     "iopub.status.idle": "2022-05-10T16:47:15.944698Z",
     "shell.execute_reply": "2022-05-10T16:47:15.944124Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "83cdb277",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "e01f9f08",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.947370Z",
     "iopub.status.busy": "2022-05-10T16:47:15.947042Z",
     "iopub.status.idle": "2022-05-10T16:47:15.963882Z",
     "shell.execute_reply": "2022-05-10T16:47:15.963277Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "498cbec3",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "15707d7d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.966511Z",
     "iopub.status.busy": "2022-05-10T16:47:15.966228Z",
     "iopub.status.idle": "2022-05-10T16:47:15.969618Z",
     "shell.execute_reply": "2022-05-10T16:47:15.969144Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "e0deae77",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:15.971847Z",
     "iopub.status.busy": "2022-05-10T16:47:15.971543Z",
     "iopub.status.idle": "2022-05-10T16:47:23.258736Z",
     "shell.execute_reply": "2022-05-10T16:47:23.258146Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-10 16:47:15.976727: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WARNING:tensorflow:AutoGraph could not transform <bound method ShapeChecker.check_shapes of <gpflow.experimental.check_shapes.checker.ShapeChecker object at 0x7f30fc68e260>> and will run it as-is.\n",
      "Please report this to the TensorFlow team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output.\n",
      "Cause: annotated name 'shape' can't be nonlocal (__autograph_generated_file6zrww2fm.py, line 99)\n",
      "To silence this warning, decorate the function with @tf.autograph.experimental.do_not_convert\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WARNING: AutoGraph could not transform <bound method ShapeChecker.check_shapes of <gpflow.experimental.check_shapes.checker.ShapeChecker object at 0x7f30fc68e260>> and will run it as-is.\n",
      "Please report this to the TensorFlow team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output.\n",
      "Cause: annotated name 'shape' can't be nonlocal (__autograph_generated_file6zrww2fm.py, line 99)\n",
      "To silence this warning, decorate the function with @tf.autograph.experimental.do_not_convert\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "632376af",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c0c187e9",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "942d6133",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:23.261676Z",
     "iopub.status.busy": "2022-05-10T16:47:23.261362Z",
     "iopub.status.idle": "2022-05-10T16:47:23.266608Z",
     "shell.execute_reply": "2022-05-10T16:47:23.266100Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cc3ddb1e",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "1aff9e57",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:23.268918Z",
     "iopub.status.busy": "2022-05-10T16:47:23.268643Z",
     "iopub.status.idle": "2022-05-10T16:47:25.289799Z",
     "shell.execute_reply": "2022-05-10T16:47:25.289231Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5334d76e",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4dad8241",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "33616077",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:25.292563Z",
     "iopub.status.busy": "2022-05-10T16:47:25.292288Z",
     "iopub.status.idle": "2022-05-10T16:47:25.308082Z",
     "shell.execute_reply": "2022-05-10T16:47:25.307588Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "f889e387",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-10T16:47:25.310376Z",
     "iopub.status.busy": "2022-05-10T16:47:25.310134Z",
     "iopub.status.idle": "2022-05-10T16:47:27.113682Z",
     "shell.execute_reply": "2022-05-10T16:47:27.113185Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "ef20efea",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
