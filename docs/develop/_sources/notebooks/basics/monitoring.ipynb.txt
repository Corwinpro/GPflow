{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "0d0cd7a4",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "5f6abdd5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:44.849272Z",
     "iopub.status.busy": "2022-06-30T13:31:44.848974Z",
     "iopub.status.idle": "2022-06-30T13:31:48.637857Z",
     "shell.execute_reply": "2022-06-30T13:31:48.637175Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-30 13:31:45.885351: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-30 13:31:45.885392: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "31241f35",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "49b76eff",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:48.641426Z",
     "iopub.status.busy": "2022-06-30T13:31:48.640921Z",
     "iopub.status.idle": "2022-06-30T13:31:48.644600Z",
     "shell.execute_reply": "2022-06-30T13:31:48.643994Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a90e33d8",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "354341c6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:48.647256Z",
     "iopub.status.busy": "2022-06-30T13:31:48.646960Z",
     "iopub.status.idle": "2022-06-30T13:31:48.650411Z",
     "shell.execute_reply": "2022-06-30T13:31:48.649829Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "9b5da74f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:48.652928Z",
     "iopub.status.busy": "2022-06-30T13:31:48.652609Z",
     "iopub.status.idle": "2022-06-30T13:31:48.769922Z",
     "shell.execute_reply": "2022-06-30T13:31:48.769069Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f6b6516fee0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAXwAAAD4CAYAAADvsV2wAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjUuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8qNh9FAAAACXBIWXMAAAsTAAALEwEAmpwYAAAYu0lEQVR4nO3dfYxc5XXH8d/xeoCFVFkSVklYMLZSZAohwcqKEFmqikNk8gJ2yAukaRXaVP4nqE1abbUoUTH5B1dWm0QKaoRIFKKiQAJkMTKV82JXSLRErLNQMODUIg14QhsnsLTBSzxen/6xM/bszL0zd/a+zb33+5EQOzN39z6TlzPPnOc85zF3FwCg/FblPQAAQDYI+ABQEQR8AKgIAj4AVAQBHwAqYnXeAwhzzjnn+Nq1a/MeBgAUyv79+3/t7uNBrw1twF+7dq1mZ2fzHgYAFIqZ/SLsNVI6AFARBHwAqAgCPgBUBAEfACqCgA8AFTG0VToAim1mrq6dew7ql/MLOndsVFOb12vrhom8h1VpBHwAiZuZq+vmB57SQmNRklSfX9DNDzwlSQT9HJHSAZC4nXsOngz2LQuNRe3cczCnEUEi4ANIwS/nFwZ6Htkg4ANI3LljowM9j2wQ8AEkbmrzeo3WRpY9N1ob0dTm9TmNCBKLtgBS0FqYDarSoXonPwR8AKnYumGiK5BTvZMvAj6ALmnNwntV7xDw00fAB7BMmrPwsCqd+vyCNu7YS5onZSzaAlgmzRr6sCod01LQd536gJmZq8e+H5Zjhg9A0qk0Tj3FGvqpzeuXfXuQloK9d1w3SJqnfdwjZlp01wTfEgIR8AF0pXGCJFFDH1S9E/YBE/Z8u85xL7qf/F0Wg7sR8AEEpnHajdZGdOVF44nk2Turd95+88MnA3W7EbNY42YxuBsBH0DPdM3E2KiuvGhc9++vp7KQGxTsez3frl+aiVYOy7FoCyA0XTMxNqpHpzdp33NHUlvIPfvMWui9++mXZnJJG3fsZQG4iYAPoG8rhLSaoc3M1fXb1493PV8bsUhtGKY2r1dtVe/UzyBVPzNzdW3csVfrpneX8oOCgA9AWzdM6LbrLtXE2KhMS7Pr26679GS6plcztDhBcueeg2qc6E7dnHXa6kipoq0bJvSGM/pnpqN8G2ktAJe5PJQcPgBJwa0QWoLKKVsLuXE2aYV9Q3h1oRF53PNHo13b79tIFXYBM8MH0FfYN4C4uf0k2ihHvbbfdVXo4U/ABxDJ1g0TenR6k36+40N6dHqTtm6YiB0kk2ijHPQ3OkX5m1Xo4U9KByiYpHeWxmmUFrZxKkqQbN13obEY630Ebea68qJx7XvuyEDvKSxtVaYe/okEfDP7pqQPS/qVu78j4HWT9FVJH5R0VNKN7v7TJO4NVEnSO0vjNkpbaZAMeh+t30tiM9dK9OrhXxZJzfC/Jelrkr4d8voHJF3Y/Oc9kv6p+W8AA0h6Z2nchcrWNdt3HdB8c6F1obGo7bsOLHs96fumJYkPjmGWSA7f3R+R9HKPS7ZI+rYveUzSmJm9LYl7A1WS9M7SpBYqXzu2vJZ+fqGhqe89GVrSWIUF0mGUVQ5/QtKLbY8PN597qf0iM9smaZskrVmzJqOhAcXRq9lY6/Uk/t4qM62b3h2a1mjP+69q5t87NU546Iw9Tu4fKzdUVTrufoe7T7r75Pj4eN7DAYZOv9z4oAuMYRUui+6hm486Nyj16nkTNmMf5kPOy7zbNquAX5d0ftvj85rPARjA1g0Tob1nzj6zNnD+ubO+PqhDZWddfb/Omu3CZuz9dvbmpey7bbNK6eySdJOZ3aOlxdpX3f2lPr8DIMAt11wSWBlzyzWXrOjvtS9UrpveHXhN+0w9ap69tqp3P5xhXCAd1sXkpCRVlvkdSX8k6RwzOyzpFkk1SXL3r0t6WEslmYe0VJb5Z0ncF6iiNMsHo+TWw/P+UqstzthoTduvvaRwQbLsi8mJBHx3/2Sf113SZ5O4F4D4s+OwzVZR6urDrhmGlExcZV9MZqctUADtAfqNozWZLTUNW8nsPspmq17fHsq8Qansu23NI5wqk4fJyUmfnZ3NexhA7vqdNzvo7Hrjjr2Bs9jWYSdVF6fVxDAws/3uPhn0GjN8YMj1q4oZdFGx7HnquIZxMTkpQ1WHD6Bbr41W7ddErRuvQldIBCPgAxkbZGPPzFxdvQ/wO6VVN/75e5/QF2eeCr1umDc9IV0EfCBDQRt7egXonXsOatBVNpd092MvhH6QDOumJ6SPHD6QoVsfOtCVj28F6MkL3tQVdFeaV3epZ16/zHnqLBVtgZcZPpCRmbm6Xgk5f7UVoDuF5dVHzPSV6y/T2GhwmwWJRdi0FbENAwEfyEi/c16DAnRYvv0fPvEuSd1tiduxCJuuXm0YhhUpHSAj/WbcQQG61yanjTv2qrEYnOFnETZ9RSxvJeADGenVy75XgA7Lt/cKLCzCpq+IbRhI6QAZCes9PzZaGzhAz8zVtSqglbG0VHVDsE9fEctbmeEDGUmqB01rsTDs4JGjx45rZq5O0E9ZEXsK0UsHyMlKS/rCeuG0K0v3SgyuVy8dUjpADuKU9EVZFBz2ahHkg4AP5CCspO9z9z7Rt93CWMgRh52GuVqkiMpw1i05fCAHvYJxUH/6dlGzsMNcLVI0Uc4QKAICPpCyoFx9rxJNaXlKpvN3X10I3q3bbtirRYqmLGfdsmgLpCjo8JLaKtNpq1fptWPhPe5bRmsjXacvnb56leYDgv6ImU64F6JapGjWTe8ObGJnkn6+40NZD6cnDkABchI0M2yccDUiBPsRs8BZ5Rm1VYEfBFTlpKeIm6yCsGgLpCjqwmnnFqrR2khonf380QbtjTNWxE1WQZjhAynql6tvcS0F7vZc/c49B0NnlbQ3zlbrP+vtuw6cTKedUSvefJmAD6RoavP6ngeQt4QdIN75u0WcVZbJ746fOPnzK0cbhavUKd5HFFAgnadLjY3WVBtZnsAJC+KcTDVcitgOuRMzfGAFerVFaH9t7Mya3KVXFxonr5Oi918hdTM8itgOuRMzfGBAvdoidL72ytGG5hcay66TpEenN+nL118mSfp8hN21yF9YRU4SlTpZ7eJlhg8MqN9X+175+vbryrBzs0qC1mOSWFPJchcvM3xgQL2+2kf5el+fXwj90Ni+60AiY0Ty0lpTyXJtgBk+MKB+m3D6lWGOmIV+MMwvNOhlP8TSWFPJcm2AGT4woF6bcMJOtWq32Gx/EKZIVR+IL821gU4EfGBAvb7at78WZqKtWidIkao+EF+Wu3gTSemY2dWSvippRNKd7r6j4/UbJe2U1Fp6/pq735nEvYE89Ppq33ptZq6uqfueVGPxVIuE2oidLMO89aEDeuVodxO0ovVnQTxZHpUYO+Cb2Yik2yW9X9JhSY+b2S53f6bj0nvd/aa49wOyttKjCCWpq8Vi2+NbrrmEnbSQlN1+iyRSOpdLOuTuz7v7MUn3SNqSwN8FchfnKMKdew6qcWJ5xG+c8JM5enbSImtJpHQmJL3Y9viwpPcEXPdRM/tDST+T9Hl3f7HzAjPbJmmbJK1ZsyaBoQHxDHLwRec3gbBqnfYcPTtpkaWsFm0fkrTW3d8p6YeS7gq6yN3vcPdJd58cHx/PaGhAuKglc0HfBDpbHreQo0dekgj4dUnntz0+T6cWZyVJ7v4bd/9d8+Gdkt6dwH2B1EUtmQv6JuAK7nNPjh55SSLgPy7pQjNbZ2anSbpB0q72C8zsbW0Pr5X0bAL3BVIXtWQu7JtAq889OXoMg9g5fHc/bmY3SdqjpbLMb7r7ATP7kqRZd98l6S/N7FpJxyW9LOnGuPcFshC1ZC4sZx/W5x7IA4eYAwkIOqycc2aRBw4xB1KW5eYZYKUI+EBCKLFEXLE2+UVAwAeAIZBFX3yapwHAEMiiLz4BHwCGQBZ98UnpAH2knVcFpP4H6ySBGT4qKeqh0XGapwGDyKIvPgEflTNIEM/yvFFUWxbdU0npoHIG6YCZ5XmjQNqlvczwUTmDBPGxM2uB164yI62DwiHgo3KidsCcmavrt68fD7x20Z1cPgqHgI/Kibo4FnRiVTty+SgacvionKh9b8JOrGpHLh9FQsBHJfVbHJuZq8vUfQZ5J06vQpGQ0gEC7NxzsG+w5/QqFA0zfCBAr1SNSey4RSER8FE6SbRC4AQrlBEpHZRKUq0QstjmDmSNGT5KpV8rhKgzf06wQhlxpi1KZd307tDF1tHaCGfOovR6nWlLSgelElYmOWJGEzRUHgEfpRKUe6+tMi2GfJOtzy9EbpUMFB05fJRKZ+79jaM1vXYsuB9Oy9R9T6qxuPSBkMY5osCwYIaP0tm6YUKPTm/Sz3d8SGedvvpkMA/T+TqpHpQVAR+lttJeN/TIQRkR8FFqK+11E9YHHygyAj5KLWgRN4rfvn6cxVuUDgEfpdZ5TujZZ9Zk1v/3GiecPD5KhyodlF5nK+R107sj/R55fJQNM3xUTtS8Pr3uUTYEfFTO1Ob1qo30zuvQKA1llEjAN7OrzeygmR0ys+mA1083s3ubr//EzNYmcV9gJbZumNDOj71LZ7dV4ozWVi3l97XUApkeOyij2Dl8MxuRdLuk90s6LOlxM9vl7s+0XfYZSa+4+++b2Q2S/l7S9XHvDaxUvyMOgTJKYoZ/uaRD7v68ux+TdI+kLR3XbJF0V/Pn+yS9zyxKrQQAIClJBPwJSS+2PT7cfC7wGnc/LulVSW/u/ENmts3MZs1s9siRIwkMDQDQMlSLtu5+h7tPuvvk+Ph43sMBgFJJog6/Lun8tsfnNZ8Luuawma2W9EZJv0ng3kBkSZx1CxRZEjP8xyVdaGbrzOw0STdI2tVxzS5Jn27+/DFJe31Yj9pCKSV11i1QZLEDfjMnf5OkPZKelfRddz9gZl8ys2ubl31D0pvN7JCkv5bUVboJpKnfWbdAFSTSWsHdH5b0cMdzf9f28+uSPp7EvYCVCGuTQPsEVMlQLdoCaQlrk0D7BFQJzdNQOkGLs1Ob1+vmB55altahfQKqhhk+SiVscVbSsjbJtE9AFTHDR6n0Wpx9dHoTAR6VxgwfpcLiLBCOGT6GUmce/sqLxrXvuSN9N02dOzaqekBwZ3EWIOBjCLXy8K3UTH1+Qf/82AsnX2/Py0vq+mC4f3+dxVkgAAEfQycoD99pobGo7bsO6HfHTyz7YLh/f10fffdEpG8DQNUQ8DF0oubb5xcaXc8tNBa177kjenR6U9LDAgqPRVsMnbj5dhZogWAEfAydqc3rNVob6XnNaG1k2RGF7VigBYIR8DF0tm6Y6Nok9SdXrOnaNHXLNZd0fTCwQAuEI4ePoTTImbP0uAeiIeCjEMIOL+EwciA6Aj5y1+8kqqC6/FYdPsEeiI4cPnIV5SSqsP44n7v3CW3csZdTq4CICPjIVZSTqHqVWXJUIRAdAR+5mZmrB/a9kZYH+X5llhxVCERDwEcuWqmcMO1BPkpdPputgP5YtEVqei3G9uqX01lL3/47Yd8I2GwF9EfARyrCKmtmf/Gy9j13JDRwSwo8iapVftn5dyU2WwFREfCRirDF2Lsfe0He4/cmxkZ7llq2z/bZbAUMhoCPVITl1HsF+6gzdTZbASvDoi1SMWhOnUPFgfQR8JGKoMoaC7l2YmyUA8aBDBDwkYqgjpefumIN3S2BHJHDR2qCcu2TF7yJBVcgJwR8ZIoFVyA/pHQAoCKY4SNT/VohA0hPrIBvZm+SdK+ktZL+S9In3P2VgOsWJbUap7zg7tfGuS+Kib72QL7ipnSmJf3Y3S+U9OPm4yAL7n5Z8x+CfUVFaYUMID1xA/4WSXc1f75L0taYfw8lFrb7lk6XQDbiBvy3uPtLzZ//W9JbQq47w8xmzewxM9sa854oqLDdt2biABMgA30Dvpn9yMyeDvhnS/t17u4Kb5VygbtPSvpjSV8xs7eH3Gtb84Nh9siRI4O+Fwy5qc3rVRvp3m97wqWp+54k6AMp6xvw3f0qd39HwD8PSvofM3ubJDX//auQv1Fv/vt5Sf8qaUPIdXe4+6S7T46Pj6/wLWFYbd0wobNOC64TaCw6uXwgZXFTOrskfbr586clPdh5gZmdbWanN38+R9JGSc/EvC8K6tWFRuhr5PKBdMUN+Dskvd/M/lPSVc3HMrNJM7uzec0fSJo1sycl7ZO0w90J+BXVq4smp1YB6YpVh+/uv5H0voDnZyX9RfPnf5N0aZz7oDymNq/X1PeeVOPE8uWe2ojRRA1IGTttkanWBqvtuw5ovpneOfvMmm655hI2XwEpI+AjczRQA/JB8zQAqAgCPgBUBAEfACqCgA8AFUHAB4CKIOADQEUQ8AGgIqjDR2wcWwgUAwEfsXBsIVAcpHQQC8cWAsXBDB+RBaVuOLYQKA5m+Iiklbqpzy/IdSp1M3ZmLfD6VWacYAUMGQI+IglL3bhLo7WRrusX3XXzA08R9IEhQsBHJGEpmlcXGrrtuks1Yt1n1ZLLB4YLAR+RhJ1Gde7YqLZumNAJDz6/nlw+MDwI+IjkyovG1TmHH62NnDylqtcHAoDhQMBHXzNzdd2/v672ObxJ+ui7Tx1kMrV5fVcuv/0DAUD+KMtEqFYZZj0gLeOS9j135OTjVuBnxy0wvAj4CNS5gzZIZ36eowuB4UbAr5BBet4ElWF2Ij8PFAsBvyIG7XkTlMZpR34eKB4WbStikJ43M3P1roqcdhNjo7rtuktJ3wAFwwy/IgbpebNzz0EFVdWbpC9ffxmBHigoZvgVMUidfNiHg4uWx0CRlS7gz8zVtXHHXq2b3q2NO/bSy6VpkDr5sA+HCRZpgUIrVcAP6+hI0F+amd923aWaGBuVqXcenk1UQDmVKoffa2GyyqmIznLMfnl4NlEB5VSqgM9hHN1WegQhm6iA8ilVSocGXt04ghBAS6yAb2YfN7MDZnbCzCZ7XHe1mR00s0NmNh3nnr2Qe+7Gtx4ALXFn+E9Luk7SI2EXmNmIpNslfUDSxZI+aWYXx7xvoEEWJquCbz0AWmLl8N39WUmygNOO2lwu6ZC7P9+89h5JWyQ9E+feYcg9Lze1eX1XE7Sqf+sBqiqLRdsJSS+2PT4s6T0Z3Bei4gbAKX0Dvpn9SNJbA176grs/mORgzGybpG2StGbNmiT/dKEN0uUyCN96AEgRAr67XxXzHnVJ57c9Pq/5XNC97pB0hyRNTk4GH5JaMV+ceUp3P/bCyd42UcsqAaBTFmWZj0u60MzWmdlpkm6QtCuD+xbezFx9WbBvoawSwErELcv8iJkdlvReSbvNbE/z+XPN7GFJcvfjkm6StEfSs5K+6+4H4g27GsK6VkqUVQIYXNwqne9L+n7A87+U9MG2xw9LejjOvaqoV1CnrBLAoEq107ZswoK6SZRVAhgYAT9lcdo1B+0cNkmfumINC7YABlaq5mnDZqWNy1p61dDHLdUEUD0E/BQl0a45qIY+7gcJgGoipZOitBqXhX2Q3PoQxU8AwhHwU5RW47KwD4xXjjY43QtAKAJ+itJq19zrA4MNWQDCEPBTlFa75l4fGGzIAhDG3IezZc3k5KTPzs7mPYyhddmtP9D8QqPr+bHRms46fTXVO0BFmdl+dw88kIoZfkFtv/aSrnRRbZXptWPHVZ9fkOtU9Q55fQASAb+wgtJFbzhjtRqLy7+x0WgNQAt1+AXWWaO/bnp34HXk9QFIzPBLhfNrAfRCwC+RtMpAAZQDKZ0S4fxaAL0Q8EuG82sBhCGlAwAVQcAHgIog4ANARRDwAaAiCPgAUBFD2zzNzI5I+kXe40jIOZJ+nfcgcsJ7rybee34ucPfxoBeGNuCXiZnNhnWvKzveO++9aob5vZPSAYCKIOADQEUQ8LNxR94DyBHvvZp470OIHD4AVAQzfACoCAI+AFQEAT8DZrbTzJ4zs/8ws++b2VjeY8qKmX3czA6Y2QkzG8pStaSZ2dVmdtDMDpnZdN7jyZKZfdPMfmVmT+c9lqyZ2flmts/Mnmn+b/6v8h5TJwJ+Nn4o6R3u/k5JP5N0c87jydLTkq6T9EjeA8mCmY1Iul3SByRdLOmTZnZxvqPK1LckXZ33IHJyXNLfuPvFkq6Q9Nlh+++egJ8Bd/+Bux9vPnxM0nl5jidL7v6su1fpFPXLJR1y9+fd/ZikeyRtyXlMmXH3RyS9nPc48uDuL7n7T5s//5+kZyUN1eEUBPzs/bmkf8l7EEjNhKQX2x4f1pD9nx7pM7O1kjZI+knOQ1mGE68SYmY/kvTWgJe+4O4PNq/5gpa+9t2d5djSFuW9A1VhZm+QdL+kz7n7/+Y9nnYE/IS4+1W9XjezGyV9WNL7vGSbH/q994qpSzq/7fF5zedQAWZW01Kwv9vdH8h7PJ1I6WTAzK6W9LeSrnX3o3mPB6l6XNKFZrbOzE6TdIOkXTmPCRkwM5P0DUnPuvs/5j2eIAT8bHxN0u9J+qGZPWFmX897QFkxs4+Y2WFJ75W028z25D2mNDUX52+StEdLi3bfdfcD+Y4qO2b2HUn/Lmm9mR02s8/kPaYMbZT0p5I2Nf9//oSZfTDvQbWjtQIAVAQzfACoCAI+AFQEAR8AKoKADwAVQcAHgIog4ANARRDwAaAi/h/ue4J1BeDpogAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "38142018",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:48.773220Z",
     "iopub.status.busy": "2022-06-30T13:31:48.772835Z",
     "iopub.status.idle": "2022-06-30T13:31:48.829615Z",
     "shell.execute_reply": "2022-06-30T13:31:48.828882Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-06-30 13:31:48.776354: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-30 13:31:48.776384: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-30 13:31:48.776408: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (8fecc56a0288): /proc/driver/nvidia/version does not exist\n",
      "2022-06-30 13:31:48.776680: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f6b651af850&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f6b651af850>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "02a0d0e2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:48.832428Z",
     "iopub.status.busy": "2022-06-30T13:31:48.832053Z",
     "iopub.status.idle": "2022-06-30T13:31:48.979392Z",
     "shell.execute_reply": "2022-06-30T13:31:48.978649Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c2b73442",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "0efd7409",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:48.982583Z",
     "iopub.status.busy": "2022-06-30T13:31:48.982244Z",
     "iopub.status.idle": "2022-06-30T13:31:48.999692Z",
     "shell.execute_reply": "2022-06-30T13:31:48.998737Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b369c5f7",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "fcb9ab4e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:49.003057Z",
     "iopub.status.busy": "2022-06-30T13:31:49.002702Z",
     "iopub.status.idle": "2022-06-30T13:31:49.007115Z",
     "shell.execute_reply": "2022-06-30T13:31:49.006332Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "3df08f70",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:49.010025Z",
     "iopub.status.busy": "2022-06-30T13:31:49.009710Z",
     "iopub.status.idle": "2022-06-30T13:31:56.363129Z",
     "shell.execute_reply": "2022-06-30T13:31:56.362339Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9013e2ed",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6c0161c9",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "e396fd75",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:56.402286Z",
     "iopub.status.busy": "2022-06-30T13:31:56.401928Z",
     "iopub.status.idle": "2022-06-30T13:31:56.407502Z",
     "shell.execute_reply": "2022-06-30T13:31:56.406827Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5180a5c8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "ed9f5528",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:56.410537Z",
     "iopub.status.busy": "2022-06-30T13:31:56.410218Z",
     "iopub.status.idle": "2022-06-30T13:31:58.387074Z",
     "shell.execute_reply": "2022-06-30T13:31:58.386366Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1053b3a0",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9185f2f9",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "b1fdcd5d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:58.390982Z",
     "iopub.status.busy": "2022-06-30T13:31:58.390648Z",
     "iopub.status.idle": "2022-06-30T13:31:58.407229Z",
     "shell.execute_reply": "2022-06-30T13:31:58.406540Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "37329554",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-30T13:31:58.410563Z",
     "iopub.status.busy": "2022-06-30T13:31:58.410243Z",
     "iopub.status.idle": "2022-06-30T13:32:00.627241Z",
     "shell.execute_reply": "2022-06-30T13:32:00.626552Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "df1460de",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
