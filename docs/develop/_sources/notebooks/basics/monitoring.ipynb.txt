{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "0b460125",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "1f75e649",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:01.941560Z",
     "iopub.status.busy": "2022-05-03T14:05:01.941342Z",
     "iopub.status.idle": "2022-05-03T14:05:05.091488Z",
     "shell.execute_reply": "2022-05-03T14:05:05.090959Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-03 14:05:02.925184: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-03 14:05:02.925212: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c10549c1",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7008deaf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.094426Z",
     "iopub.status.busy": "2022-05-03T14:05:05.094202Z",
     "iopub.status.idle": "2022-05-03T14:05:05.096976Z",
     "shell.execute_reply": "2022-05-03T14:05:05.096498Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6b391da4",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "e16749ad",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.099022Z",
     "iopub.status.busy": "2022-05-03T14:05:05.098842Z",
     "iopub.status.idle": "2022-05-03T14:05:05.101486Z",
     "shell.execute_reply": "2022-05-03T14:05:05.101010Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "17987b12",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.103538Z",
     "iopub.status.busy": "2022-05-03T14:05:05.103349Z",
     "iopub.status.idle": "2022-05-03T14:05:05.231239Z",
     "shell.execute_reply": "2022-05-03T14:05:05.230037Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f2c79c86290>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "53ea9d12",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.234957Z",
     "iopub.status.busy": "2022-05-03T14:05:05.234599Z",
     "iopub.status.idle": "2022-05-03T14:05:05.285767Z",
     "shell.execute_reply": "2022-05-03T14:05:05.285179Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-03 14:05:05.237850: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-03 14:05:05.237878: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-03 14:05:05.237898: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (c38c719fb7f4): /proc/driver/nvidia/version does not exist\n",
      "2022-05-03 14:05:05.238186: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f2c79a7da80&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f2c79a7da80>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "985e77b4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.288048Z",
     "iopub.status.busy": "2022-05-03T14:05:05.287836Z",
     "iopub.status.idle": "2022-05-03T14:05:05.444570Z",
     "shell.execute_reply": "2022-05-03T14:05:05.444092Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "53de4728",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "e5af1a36",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.447200Z",
     "iopub.status.busy": "2022-05-03T14:05:05.446893Z",
     "iopub.status.idle": "2022-05-03T14:05:05.463514Z",
     "shell.execute_reply": "2022-05-03T14:05:05.462956Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8d964ad9",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "6a8d9f1b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.466476Z",
     "iopub.status.busy": "2022-05-03T14:05:05.466252Z",
     "iopub.status.idle": "2022-05-03T14:05:05.469571Z",
     "shell.execute_reply": "2022-05-03T14:05:05.469092Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "0d7a32d8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:05.471951Z",
     "iopub.status.busy": "2022-05-03T14:05:05.471753Z",
     "iopub.status.idle": "2022-05-03T14:05:11.914989Z",
     "shell.execute_reply": "2022-05-03T14:05:11.914441Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-03 14:05:05.476675: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4d4f09f1",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9ff26ee9",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "8b26dccc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:11.917867Z",
     "iopub.status.busy": "2022-05-03T14:05:11.917626Z",
     "iopub.status.idle": "2022-05-03T14:05:11.922844Z",
     "shell.execute_reply": "2022-05-03T14:05:11.922407Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7be794a7",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "02f35051",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:11.925207Z",
     "iopub.status.busy": "2022-05-03T14:05:11.924970Z",
     "iopub.status.idle": "2022-05-03T14:05:14.141997Z",
     "shell.execute_reply": "2022-05-03T14:05:14.141426Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e363b38b",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cc1add5b",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "42aa72ba",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:14.145738Z",
     "iopub.status.busy": "2022-05-03T14:05:14.145476Z",
     "iopub.status.idle": "2022-05-03T14:05:14.163070Z",
     "shell.execute_reply": "2022-05-03T14:05:14.162516Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "7f8c0e8c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-03T14:05:14.165940Z",
     "iopub.status.busy": "2022-05-03T14:05:14.165684Z",
     "iopub.status.idle": "2022-05-03T14:05:16.166854Z",
     "shell.execute_reply": "2022-05-03T14:05:16.166297Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "98a07ba6",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
