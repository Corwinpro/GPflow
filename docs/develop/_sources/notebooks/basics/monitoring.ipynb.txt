{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "4a747b4e",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "29f4b6ab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:51.776563Z",
     "iopub.status.busy": "2022-03-30T09:34:51.776314Z",
     "iopub.status.idle": "2022-03-30T09:34:54.892646Z",
     "shell.execute_reply": "2022-03-30T09:34:54.892132Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-03-30 09:34:52.816222: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-03-30 09:34:52.816250: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "13655891",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "35700a0f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:54.895452Z",
     "iopub.status.busy": "2022-03-30T09:34:54.895230Z",
     "iopub.status.idle": "2022-03-30T09:34:54.897915Z",
     "shell.execute_reply": "2022-03-30T09:34:54.897424Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e8babdee",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "3490ff3e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:54.900088Z",
     "iopub.status.busy": "2022-03-30T09:34:54.899892Z",
     "iopub.status.idle": "2022-03-30T09:34:54.903798Z",
     "shell.execute_reply": "2022-03-30T09:34:54.902026Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "cba04ac3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:54.906252Z",
     "iopub.status.busy": "2022-03-30T09:34:54.906060Z",
     "iopub.status.idle": "2022-03-30T09:34:55.000949Z",
     "shell.execute_reply": "2022-03-30T09:34:55.000380Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fc71ffdf4f0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "f95a6ecf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:55.004123Z",
     "iopub.status.busy": "2022-03-30T09:34:55.003907Z",
     "iopub.status.idle": "2022-03-30T09:34:55.055350Z",
     "shell.execute_reply": "2022-03-30T09:34:55.054865Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-03-30 09:34:55.006026: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-03-30 09:34:55.006060: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-03-30 09:34:55.006079: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (2547946ad888): /proc/driver/nvidia/version does not exist\n",
      "2022-03-30 09:34:55.006355: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fc72003ad70&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fc72003ad70>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "3d9874db",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:55.057676Z",
     "iopub.status.busy": "2022-03-30T09:34:55.057428Z",
     "iopub.status.idle": "2022-03-30T09:34:55.197943Z",
     "shell.execute_reply": "2022-03-30T09:34:55.197306Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "995347c7",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "9620d9b8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:55.200577Z",
     "iopub.status.busy": "2022-03-30T09:34:55.200337Z",
     "iopub.status.idle": "2022-03-30T09:34:55.372974Z",
     "shell.execute_reply": "2022-03-30T09:34:55.372164Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9b23821e",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "f9e2223d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:55.376713Z",
     "iopub.status.busy": "2022-03-30T09:34:55.376385Z",
     "iopub.status.idle": "2022-03-30T09:34:55.380989Z",
     "shell.execute_reply": "2022-03-30T09:34:55.380389Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "f8b73318",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:34:55.384141Z",
     "iopub.status.busy": "2022-03-30T09:34:55.383852Z",
     "iopub.status.idle": "2022-03-30T09:35:01.568276Z",
     "shell.execute_reply": "2022-03-30T09:35:01.567763Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-03-30 09:34:55.391679: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d36d21c8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6e937c46",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "e720635e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:35:01.571083Z",
     "iopub.status.busy": "2022-03-30T09:35:01.570870Z",
     "iopub.status.idle": "2022-03-30T09:35:01.575338Z",
     "shell.execute_reply": "2022-03-30T09:35:01.574922Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ed82aece",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "cfedb149",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:35:01.577648Z",
     "iopub.status.busy": "2022-03-30T09:35:01.577452Z",
     "iopub.status.idle": "2022-03-30T09:35:03.415945Z",
     "shell.execute_reply": "2022-03-30T09:35:03.415436Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ac8f631b",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eb1b55ef",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "879890b3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:35:03.419370Z",
     "iopub.status.busy": "2022-03-30T09:35:03.419148Z",
     "iopub.status.idle": "2022-03-30T09:35:03.435089Z",
     "shell.execute_reply": "2022-03-30T09:35:03.434548Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "1bb881f3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-30T09:35:03.438212Z",
     "iopub.status.busy": "2022-03-30T09:35:03.438007Z",
     "iopub.status.idle": "2022-03-30T09:35:05.408882Z",
     "shell.execute_reply": "2022-03-30T09:35:05.408422Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c22d36e3",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
