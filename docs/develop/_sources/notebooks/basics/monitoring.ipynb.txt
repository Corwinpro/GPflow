{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "f3cc7986",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "ce7b7182",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:36.490321Z",
     "iopub.status.busy": "2022-05-16T10:20:36.490000Z",
     "iopub.status.idle": "2022-05-16T10:20:39.554046Z",
     "shell.execute_reply": "2022-05-16T10:20:39.553373Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-16 10:20:37.441885: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-16 10:20:37.441912: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9af08b84",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "8dee21e6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.556715Z",
     "iopub.status.busy": "2022-05-16T10:20:39.556248Z",
     "iopub.status.idle": "2022-05-16T10:20:39.559688Z",
     "shell.execute_reply": "2022-05-16T10:20:39.559109Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "be41c9fc",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "2c779cad",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.561916Z",
     "iopub.status.busy": "2022-05-16T10:20:39.561640Z",
     "iopub.status.idle": "2022-05-16T10:20:39.564782Z",
     "shell.execute_reply": "2022-05-16T10:20:39.564214Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "15efd9db",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.566934Z",
     "iopub.status.busy": "2022-05-16T10:20:39.566701Z",
     "iopub.status.idle": "2022-05-16T10:20:39.660749Z",
     "shell.execute_reply": "2022-05-16T10:20:39.660092Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7efcec3c9db0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "747dff10",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.663217Z",
     "iopub.status.busy": "2022-05-16T10:20:39.662948Z",
     "iopub.status.idle": "2022-05-16T10:20:39.712787Z",
     "shell.execute_reply": "2022-05-16T10:20:39.712128Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-16 10:20:39.665186: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-16 10:20:39.665214: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-16 10:20:39.665233: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (e36ca1228ba7): /proc/driver/nvidia/version does not exist\n",
      "2022-05-16 10:20:39.665492: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7efcec4202b0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7efcec4202b0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "8ff5d3e6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.715084Z",
     "iopub.status.busy": "2022-05-16T10:20:39.714817Z",
     "iopub.status.idle": "2022-05-16T10:20:39.862909Z",
     "shell.execute_reply": "2022-05-16T10:20:39.862213Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e682fc11",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "b79abeac",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.865311Z",
     "iopub.status.busy": "2022-05-16T10:20:39.865042Z",
     "iopub.status.idle": "2022-05-16T10:20:39.880863Z",
     "shell.execute_reply": "2022-05-16T10:20:39.880171Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "21d268a4",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "8da0911f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.883810Z",
     "iopub.status.busy": "2022-05-16T10:20:39.883521Z",
     "iopub.status.idle": "2022-05-16T10:20:39.887264Z",
     "shell.execute_reply": "2022-05-16T10:20:39.886668Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "f6bdba53",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:39.889386Z",
     "iopub.status.busy": "2022-05-16T10:20:39.889143Z",
     "iopub.status.idle": "2022-05-16T10:20:47.340467Z",
     "shell.execute_reply": "2022-05-16T10:20:47.339906Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-16 10:20:39.894037: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WARNING:tensorflow:AutoGraph could not transform <bound method ShapeChecker.check_shapes of <gpflow.experimental.check_shapes.checker.ShapeChecker object at 0x7efce058e530>> and will run it as-is.\n",
      "Please report this to the TensorFlow team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output.\n",
      "Cause: annotated name 'shape' can't be nonlocal (__autograph_generated_fileftrbe401.py, line 99)\n",
      "To silence this warning, decorate the function with @tf.autograph.experimental.do_not_convert\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WARNING: AutoGraph could not transform <bound method ShapeChecker.check_shapes of <gpflow.experimental.check_shapes.checker.ShapeChecker object at 0x7efce058e530>> and will run it as-is.\n",
      "Please report this to the TensorFlow team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output.\n",
      "Cause: annotated name 'shape' can't be nonlocal (__autograph_generated_fileftrbe401.py, line 99)\n",
      "To silence this warning, decorate the function with @tf.autograph.experimental.do_not_convert\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f9e0b438",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f49e815e",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "42c683f2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:47.343300Z",
     "iopub.status.busy": "2022-05-16T10:20:47.342999Z",
     "iopub.status.idle": "2022-05-16T10:20:47.348429Z",
     "shell.execute_reply": "2022-05-16T10:20:47.347790Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2594159f",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "11db5925",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:47.351732Z",
     "iopub.status.busy": "2022-05-16T10:20:47.351412Z",
     "iopub.status.idle": "2022-05-16T10:20:49.281145Z",
     "shell.execute_reply": "2022-05-16T10:20:49.280507Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8cc4fb0f",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "00c1c0e3",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "e5ab7c02",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:49.284184Z",
     "iopub.status.busy": "2022-05-16T10:20:49.283849Z",
     "iopub.status.idle": "2022-05-16T10:20:49.301082Z",
     "shell.execute_reply": "2022-05-16T10:20:49.300446Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "dc5fd088",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-16T10:20:49.303926Z",
     "iopub.status.busy": "2022-05-16T10:20:49.303640Z",
     "iopub.status.idle": "2022-05-16T10:20:51.131293Z",
     "shell.execute_reply": "2022-05-16T10:20:51.130767Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c8896212",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
