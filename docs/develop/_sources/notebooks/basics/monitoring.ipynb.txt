{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "ef482d14",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "d956e860",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:01.436867Z",
     "iopub.status.busy": "2022-04-07T15:10:01.436595Z",
     "iopub.status.idle": "2022-04-07T15:10:04.915943Z",
     "shell.execute_reply": "2022-04-07T15:10:04.915277Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-07 15:10:02.471006: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-04-07 15:10:02.471042: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7579158a",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "bd0783ae",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:04.918854Z",
     "iopub.status.busy": "2022-04-07T15:10:04.918630Z",
     "iopub.status.idle": "2022-04-07T15:10:04.921742Z",
     "shell.execute_reply": "2022-04-07T15:10:04.921198Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ac5bf5f7",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "fd4b13c1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:04.923953Z",
     "iopub.status.busy": "2022-04-07T15:10:04.923730Z",
     "iopub.status.idle": "2022-04-07T15:10:04.927161Z",
     "shell.execute_reply": "2022-04-07T15:10:04.926635Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "b44e965c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:04.929592Z",
     "iopub.status.busy": "2022-04-07T15:10:04.929401Z",
     "iopub.status.idle": "2022-04-07T15:10:05.026497Z",
     "shell.execute_reply": "2022-04-07T15:10:05.026042Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f59f5660400>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "c4100d53",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:05.029181Z",
     "iopub.status.busy": "2022-04-07T15:10:05.028962Z",
     "iopub.status.idle": "2022-04-07T15:10:05.124949Z",
     "shell.execute_reply": "2022-04-07T15:10:05.124476Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-07 15:10:05.031159: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-04-07 15:10:05.031187: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-04-07 15:10:05.031205: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (94e42e34a5cd): /proc/driver/nvidia/version does not exist\n",
      "2022-04-07 15:10:05.031470: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f59f5661a50&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f59f5661a50>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "0fc2b946",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:05.127373Z",
     "iopub.status.busy": "2022-04-07T15:10:05.127155Z",
     "iopub.status.idle": "2022-04-07T15:10:05.477610Z",
     "shell.execute_reply": "2022-04-07T15:10:05.476674Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4fd54e7d",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "a0290aa4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:05.481257Z",
     "iopub.status.busy": "2022-04-07T15:10:05.480983Z",
     "iopub.status.idle": "2022-04-07T15:10:05.498861Z",
     "shell.execute_reply": "2022-04-07T15:10:05.498285Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3d7de7ae",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "ce5f4ecb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:05.501840Z",
     "iopub.status.busy": "2022-04-07T15:10:05.501618Z",
     "iopub.status.idle": "2022-04-07T15:10:05.505098Z",
     "shell.execute_reply": "2022-04-07T15:10:05.504553Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "882bf8ee",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:05.507375Z",
     "iopub.status.busy": "2022-04-07T15:10:05.507146Z",
     "iopub.status.idle": "2022-04-07T15:10:12.718768Z",
     "shell.execute_reply": "2022-04-07T15:10:12.718026Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-07 15:10:05.514115: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5bd3321e",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f6033a7e",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "f0178fa6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:12.721900Z",
     "iopub.status.busy": "2022-04-07T15:10:12.721651Z",
     "iopub.status.idle": "2022-04-07T15:10:12.727333Z",
     "shell.execute_reply": "2022-04-07T15:10:12.726737Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "66b0b4af",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "5f67fbda",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:12.729684Z",
     "iopub.status.busy": "2022-04-07T15:10:12.729481Z",
     "iopub.status.idle": "2022-04-07T15:10:15.023957Z",
     "shell.execute_reply": "2022-04-07T15:10:15.023417Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "18e027ed",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "26ca917d",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "ee874ca8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:15.027692Z",
     "iopub.status.busy": "2022-04-07T15:10:15.027383Z",
     "iopub.status.idle": "2022-04-07T15:10:15.047753Z",
     "shell.execute_reply": "2022-04-07T15:10:15.047184Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "58bdf4f3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T15:10:15.051193Z",
     "iopub.status.busy": "2022-04-07T15:10:15.050960Z",
     "iopub.status.idle": "2022-04-07T15:10:17.528393Z",
     "shell.execute_reply": "2022-04-07T15:10:17.527753Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2b3f4b3d",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
