{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "57950aa6",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3e1a2b33",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:52.858455Z",
     "iopub.status.busy": "2022-04-01T16:15:52.858198Z",
     "iopub.status.idle": "2022-04-01T16:15:55.927685Z",
     "shell.execute_reply": "2022-04-01T16:15:55.927172Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-01 16:15:53.856722: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-04-01 16:15:53.856752: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "06b68f6a",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "95529af8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:55.931594Z",
     "iopub.status.busy": "2022-04-01T16:15:55.931348Z",
     "iopub.status.idle": "2022-04-01T16:15:55.934494Z",
     "shell.execute_reply": "2022-04-01T16:15:55.933955Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1ceb77a1",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "fc559865",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:55.937414Z",
     "iopub.status.busy": "2022-04-01T16:15:55.937204Z",
     "iopub.status.idle": "2022-04-01T16:15:55.939946Z",
     "shell.execute_reply": "2022-04-01T16:15:55.939538Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "0f59f5a4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:55.942814Z",
     "iopub.status.busy": "2022-04-01T16:15:55.942559Z",
     "iopub.status.idle": "2022-04-01T16:15:56.033638Z",
     "shell.execute_reply": "2022-04-01T16:15:56.033117Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f6bfbc99a80>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "5088c2d8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:56.038538Z",
     "iopub.status.busy": "2022-04-01T16:15:56.036861Z",
     "iopub.status.idle": "2022-04-01T16:15:56.089357Z",
     "shell.execute_reply": "2022-04-01T16:15:56.088731Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-01 16:15:56.040834: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-04-01 16:15:56.040865: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-04-01 16:15:56.040883: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (ec1d416b7858): /proc/driver/nvidia/version does not exist\n",
      "2022-04-01 16:15:56.041166: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f6bfbc9af80&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f6bfbc9af80>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "8687c229",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:56.091584Z",
     "iopub.status.busy": "2022-04-01T16:15:56.091371Z",
     "iopub.status.idle": "2022-04-01T16:15:56.367818Z",
     "shell.execute_reply": "2022-04-01T16:15:56.367050Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "16a37090",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "0634c184",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:56.371446Z",
     "iopub.status.busy": "2022-04-01T16:15:56.371147Z",
     "iopub.status.idle": "2022-04-01T16:15:56.396009Z",
     "shell.execute_reply": "2022-04-01T16:15:56.395483Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f95b1bbe",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "2a580cb5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:56.399011Z",
     "iopub.status.busy": "2022-04-01T16:15:56.398713Z",
     "iopub.status.idle": "2022-04-01T16:15:56.404812Z",
     "shell.execute_reply": "2022-04-01T16:15:56.402983Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "5b8e6d8d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:15:56.407149Z",
     "iopub.status.busy": "2022-04-01T16:15:56.406941Z",
     "iopub.status.idle": "2022-04-01T16:16:03.293827Z",
     "shell.execute_reply": "2022-04-01T16:16:03.293248Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-01 16:15:56.411759: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "feedc774",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1852b168",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "294e5296",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:16:03.296694Z",
     "iopub.status.busy": "2022-04-01T16:16:03.296455Z",
     "iopub.status.idle": "2022-04-01T16:16:03.301761Z",
     "shell.execute_reply": "2022-04-01T16:16:03.301271Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5fe205a2",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "60ab881d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:16:03.304648Z",
     "iopub.status.busy": "2022-04-01T16:16:03.304399Z",
     "iopub.status.idle": "2022-04-01T16:16:05.240215Z",
     "shell.execute_reply": "2022-04-01T16:16:05.239640Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a2495c15",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cd7b2dd7",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "6ce34431",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:16:05.242958Z",
     "iopub.status.busy": "2022-04-01T16:16:05.242723Z",
     "iopub.status.idle": "2022-04-01T16:16:05.260711Z",
     "shell.execute_reply": "2022-04-01T16:16:05.260117Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "1583740b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-01T16:16:05.263476Z",
     "iopub.status.busy": "2022-04-01T16:16:05.263054Z",
     "iopub.status.idle": "2022-04-01T16:16:07.404860Z",
     "shell.execute_reply": "2022-04-01T16:16:07.404371Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1ee1783b",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
