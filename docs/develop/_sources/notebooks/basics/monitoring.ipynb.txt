{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "5ba169a6",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "f4d74ac5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:05.439657Z",
     "iopub.status.busy": "2022-04-07T09:34:05.439435Z",
     "iopub.status.idle": "2022-04-07T09:34:08.483192Z",
     "shell.execute_reply": "2022-04-07T09:34:08.482563Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-07 09:34:06.451288: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-04-07 09:34:06.451321: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "63f6499b",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "4a088e54",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.486407Z",
     "iopub.status.busy": "2022-04-07T09:34:08.486167Z",
     "iopub.status.idle": "2022-04-07T09:34:08.489199Z",
     "shell.execute_reply": "2022-04-07T09:34:08.488710Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f2cbc249",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "9f12396d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.491463Z",
     "iopub.status.busy": "2022-04-07T09:34:08.491261Z",
     "iopub.status.idle": "2022-04-07T09:34:08.494140Z",
     "shell.execute_reply": "2022-04-07T09:34:08.493704Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "1f187557",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.496390Z",
     "iopub.status.busy": "2022-04-07T09:34:08.496188Z",
     "iopub.status.idle": "2022-04-07T09:34:08.585964Z",
     "shell.execute_reply": "2022-04-07T09:34:08.585421Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f0a723e75e0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "9b2e96c8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.588931Z",
     "iopub.status.busy": "2022-04-07T09:34:08.588670Z",
     "iopub.status.idle": "2022-04-07T09:34:08.639691Z",
     "shell.execute_reply": "2022-04-07T09:34:08.639212Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-07 09:34:08.591554: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-04-07 09:34:08.591593: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-04-07 09:34:08.591616: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (cd2dc623e68a): /proc/driver/nvidia/version does not exist\n",
      "2022-04-07 09:34:08.591945: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f0a72435540&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f0a72435540>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "ac88859c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.641851Z",
     "iopub.status.busy": "2022-04-07T09:34:08.641654Z",
     "iopub.status.idle": "2022-04-07T09:34:08.908942Z",
     "shell.execute_reply": "2022-04-07T09:34:08.908395Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7f1f921a",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "fffaf708",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.911590Z",
     "iopub.status.busy": "2022-04-07T09:34:08.911345Z",
     "iopub.status.idle": "2022-04-07T09:34:08.928697Z",
     "shell.execute_reply": "2022-04-07T09:34:08.928160Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c06ca89e",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "11f1efa4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.931233Z",
     "iopub.status.busy": "2022-04-07T09:34:08.931027Z",
     "iopub.status.idle": "2022-04-07T09:34:08.934443Z",
     "shell.execute_reply": "2022-04-07T09:34:08.933972Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "d071d37e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:08.936727Z",
     "iopub.status.busy": "2022-04-07T09:34:08.936547Z",
     "iopub.status.idle": "2022-04-07T09:34:15.187418Z",
     "shell.execute_reply": "2022-04-07T09:34:15.186605Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-07 09:34:08.941441: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dc088fed",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "77de6ce5",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "92400908",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:15.190797Z",
     "iopub.status.busy": "2022-04-07T09:34:15.190412Z",
     "iopub.status.idle": "2022-04-07T09:34:15.196341Z",
     "shell.execute_reply": "2022-04-07T09:34:15.195746Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "93f027d6",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "eb8d3604",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:15.199400Z",
     "iopub.status.busy": "2022-04-07T09:34:15.199160Z",
     "iopub.status.idle": "2022-04-07T09:34:17.301377Z",
     "shell.execute_reply": "2022-04-07T09:34:17.300511Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4809faa6",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "414ce80c",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "01778ee8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:17.304609Z",
     "iopub.status.busy": "2022-04-07T09:34:17.304360Z",
     "iopub.status.idle": "2022-04-07T09:34:17.321037Z",
     "shell.execute_reply": "2022-04-07T09:34:17.320521Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "69499641",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-07T09:34:17.323716Z",
     "iopub.status.busy": "2022-04-07T09:34:17.323506Z",
     "iopub.status.idle": "2022-04-07T09:34:19.473211Z",
     "shell.execute_reply": "2022-04-07T09:34:19.472610Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "015761c0",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
