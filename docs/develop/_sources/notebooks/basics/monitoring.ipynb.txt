{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "0b4c0537",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "f8335843",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:36.981100Z",
     "iopub.status.busy": "2022-06-28T15:05:36.980799Z",
     "iopub.status.idle": "2022-06-28T15:05:40.312137Z",
     "shell.execute_reply": "2022-06-28T15:05:40.311528Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-28 15:05:37.933918: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-28 15:05:37.933943: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "524549e9",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "d2eec1c8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.315497Z",
     "iopub.status.busy": "2022-06-28T15:05:40.315068Z",
     "iopub.status.idle": "2022-06-28T15:05:40.318227Z",
     "shell.execute_reply": "2022-06-28T15:05:40.317736Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "485498a4",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "bc44e101",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.320703Z",
     "iopub.status.busy": "2022-06-28T15:05:40.320462Z",
     "iopub.status.idle": "2022-06-28T15:05:40.323197Z",
     "shell.execute_reply": "2022-06-28T15:05:40.322730Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "b4e07bcc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.325408Z",
     "iopub.status.busy": "2022-06-28T15:05:40.325173Z",
     "iopub.status.idle": "2022-06-28T15:05:40.451685Z",
     "shell.execute_reply": "2022-06-28T15:05:40.450873Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f7e9aa44d30>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "2f8fcb12",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.455611Z",
     "iopub.status.busy": "2022-06-28T15:05:40.455261Z",
     "iopub.status.idle": "2022-06-28T15:05:40.503998Z",
     "shell.execute_reply": "2022-06-28T15:05:40.503427Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-28 15:05:40.457719: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-28 15:05:40.457751: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-28 15:05:40.457770: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (9ab0ee389f83): /proc/driver/nvidia/version does not exist\n",
      "2022-06-28 15:05:40.458023: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f7e9a839360&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f7e9a839360>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "f64a1dd0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.506587Z",
     "iopub.status.busy": "2022-06-28T15:05:40.506315Z",
     "iopub.status.idle": "2022-06-28T15:05:40.662513Z",
     "shell.execute_reply": "2022-06-28T15:05:40.661933Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6cb4daca",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "3c8f06cf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.665279Z",
     "iopub.status.busy": "2022-06-28T15:05:40.665007Z",
     "iopub.status.idle": "2022-06-28T15:05:40.680002Z",
     "shell.execute_reply": "2022-06-28T15:05:40.679492Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "beea2919",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "2dd61b56",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.682556Z",
     "iopub.status.busy": "2022-06-28T15:05:40.682302Z",
     "iopub.status.idle": "2022-06-28T15:05:40.685617Z",
     "shell.execute_reply": "2022-06-28T15:05:40.685135Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "7eb766d0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:40.687934Z",
     "iopub.status.busy": "2022-06-28T15:05:40.687703Z",
     "iopub.status.idle": "2022-06-28T15:05:47.055007Z",
     "shell.execute_reply": "2022-06-28T15:05:47.054121Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8acc0275",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "848eae48",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "ca986120",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:47.090076Z",
     "iopub.status.busy": "2022-06-28T15:05:47.089744Z",
     "iopub.status.idle": "2022-06-28T15:05:47.094758Z",
     "shell.execute_reply": "2022-06-28T15:05:47.094240Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f39d1e36",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "cd52fdde",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:47.097256Z",
     "iopub.status.busy": "2022-06-28T15:05:47.097019Z",
     "iopub.status.idle": "2022-06-28T15:05:48.982734Z",
     "shell.execute_reply": "2022-06-28T15:05:48.982089Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "657e03a9",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cf28375d",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "32950a86",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:48.985946Z",
     "iopub.status.busy": "2022-06-28T15:05:48.985659Z",
     "iopub.status.idle": "2022-06-28T15:05:49.001544Z",
     "shell.execute_reply": "2022-06-28T15:05:49.000988Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "0eba5c4a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T15:05:49.004267Z",
     "iopub.status.busy": "2022-06-28T15:05:49.003973Z",
     "iopub.status.idle": "2022-06-28T15:05:51.068347Z",
     "shell.execute_reply": "2022-06-28T15:05:51.067751Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e1fcf87d",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
