{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "359dcb95",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "d49be787",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:37.522632Z",
     "iopub.status.busy": "2022-06-28T11:53:37.522175Z",
     "iopub.status.idle": "2022-06-28T11:53:40.784762Z",
     "shell.execute_reply": "2022-06-28T11:53:40.784136Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-28 11:53:38.421371: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-28 11:53:38.421399: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bbc79b7b",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "b848d3ea",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:40.788235Z",
     "iopub.status.busy": "2022-06-28T11:53:40.787790Z",
     "iopub.status.idle": "2022-06-28T11:53:40.790943Z",
     "shell.execute_reply": "2022-06-28T11:53:40.790437Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d0856597",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "c2fcc534",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:40.793517Z",
     "iopub.status.busy": "2022-06-28T11:53:40.793280Z",
     "iopub.status.idle": "2022-06-28T11:53:40.796049Z",
     "shell.execute_reply": "2022-06-28T11:53:40.795532Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "abed1f16",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:40.798343Z",
     "iopub.status.busy": "2022-06-28T11:53:40.798084Z",
     "iopub.status.idle": "2022-06-28T11:53:40.889300Z",
     "shell.execute_reply": "2022-06-28T11:53:40.888732Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fb509a79210>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "3bee0ef3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:40.892096Z",
     "iopub.status.busy": "2022-06-28T11:53:40.891810Z",
     "iopub.status.idle": "2022-06-28T11:53:40.954498Z",
     "shell.execute_reply": "2022-06-28T11:53:40.940941Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-28 11:53:40.894228: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-28 11:53:40.894261: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-28 11:53:40.894281: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (fab6c846b65d): /proc/driver/nvidia/version does not exist\n",
      "2022-06-28 11:53:40.894523: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fb509ab4e80&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fb509ab4e80>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "22b9626e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:40.957394Z",
     "iopub.status.busy": "2022-06-28T11:53:40.957110Z",
     "iopub.status.idle": "2022-06-28T11:53:41.085404Z",
     "shell.execute_reply": "2022-06-28T11:53:41.084819Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d8c1ac55",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "a2217168",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:41.088219Z",
     "iopub.status.busy": "2022-06-28T11:53:41.087938Z",
     "iopub.status.idle": "2022-06-28T11:53:41.103324Z",
     "shell.execute_reply": "2022-06-28T11:53:41.102752Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "43a4312b",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "224eb418",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:41.106075Z",
     "iopub.status.busy": "2022-06-28T11:53:41.105813Z",
     "iopub.status.idle": "2022-06-28T11:53:41.109267Z",
     "shell.execute_reply": "2022-06-28T11:53:41.108767Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "d389b232",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:41.111631Z",
     "iopub.status.busy": "2022-06-28T11:53:41.111371Z",
     "iopub.status.idle": "2022-06-28T11:53:47.284705Z",
     "shell.execute_reply": "2022-06-28T11:53:47.284066Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f03f6d9e",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "292c4578",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "bf5f0e6b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:47.317473Z",
     "iopub.status.busy": "2022-06-28T11:53:47.317147Z",
     "iopub.status.idle": "2022-06-28T11:53:47.322007Z",
     "shell.execute_reply": "2022-06-28T11:53:47.321474Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "297522d8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "68f5b71c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:47.324660Z",
     "iopub.status.busy": "2022-06-28T11:53:47.324415Z",
     "iopub.status.idle": "2022-06-28T11:53:49.189707Z",
     "shell.execute_reply": "2022-06-28T11:53:49.189054Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6b5b5ec9",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "94b9f9ef",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "095462c8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:49.193027Z",
     "iopub.status.busy": "2022-06-28T11:53:49.192722Z",
     "iopub.status.idle": "2022-06-28T11:53:49.208375Z",
     "shell.execute_reply": "2022-06-28T11:53:49.207828Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "ef8e9a3b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-28T11:53:49.211018Z",
     "iopub.status.busy": "2022-06-28T11:53:49.210758Z",
     "iopub.status.idle": "2022-06-28T11:53:51.208492Z",
     "shell.execute_reply": "2022-06-28T11:53:51.207906Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "efb83fd9",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
