{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "8f329889",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "01455a58",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:36.457997Z",
     "iopub.status.busy": "2022-06-27T15:13:36.457708Z",
     "iopub.status.idle": "2022-06-27T15:13:39.888763Z",
     "shell.execute_reply": "2022-06-27T15:13:39.888029Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-27 15:13:37.478996: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-27 15:13:37.479024: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fe4c696f",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "b1570a5d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:39.892342Z",
     "iopub.status.busy": "2022-06-27T15:13:39.891849Z",
     "iopub.status.idle": "2022-06-27T15:13:39.895424Z",
     "shell.execute_reply": "2022-06-27T15:13:39.894753Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "36eb0347",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "3f42a16c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:39.897898Z",
     "iopub.status.busy": "2022-06-27T15:13:39.897636Z",
     "iopub.status.idle": "2022-06-27T15:13:39.900862Z",
     "shell.execute_reply": "2022-06-27T15:13:39.900236Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "c0fb5aba",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:39.903186Z",
     "iopub.status.busy": "2022-06-27T15:13:39.902917Z",
     "iopub.status.idle": "2022-06-27T15:13:39.995983Z",
     "shell.execute_reply": "2022-06-27T15:13:39.995276Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f8b50e39ed0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "7912781d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:39.998824Z",
     "iopub.status.busy": "2022-06-27T15:13:39.998530Z",
     "iopub.status.idle": "2022-06-27T15:13:40.085796Z",
     "shell.execute_reply": "2022-06-27T15:13:40.085115Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-27 15:13:40.000863: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-27 15:13:40.000895: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-27 15:13:40.000916: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (fb69db4454ce): /proc/driver/nvidia/version does not exist\n",
      "2022-06-27 15:13:40.001158: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f8b50c30070&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f8b50c30070>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "cc4f7452",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:40.088493Z",
     "iopub.status.busy": "2022-06-27T15:13:40.088187Z",
     "iopub.status.idle": "2022-06-27T15:13:40.249214Z",
     "shell.execute_reply": "2022-06-27T15:13:40.248601Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9e1a419d",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "55d4f609",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:40.252126Z",
     "iopub.status.busy": "2022-06-27T15:13:40.251822Z",
     "iopub.status.idle": "2022-06-27T15:13:40.267874Z",
     "shell.execute_reply": "2022-06-27T15:13:40.267216Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e620657c",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "96a0be15",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:40.271145Z",
     "iopub.status.busy": "2022-06-27T15:13:40.270850Z",
     "iopub.status.idle": "2022-06-27T15:13:40.274337Z",
     "shell.execute_reply": "2022-06-27T15:13:40.273819Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "b9ca43b4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:40.276726Z",
     "iopub.status.busy": "2022-06-27T15:13:40.276323Z",
     "iopub.status.idle": "2022-06-27T15:13:46.868275Z",
     "shell.execute_reply": "2022-06-27T15:13:46.867637Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4498cefb",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e71e4789",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "202f4758",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:46.884642Z",
     "iopub.status.busy": "2022-06-27T15:13:46.884329Z",
     "iopub.status.idle": "2022-06-27T15:13:46.888927Z",
     "shell.execute_reply": "2022-06-27T15:13:46.888405Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "43b41275",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "4e4c6f31",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:46.891377Z",
     "iopub.status.busy": "2022-06-27T15:13:46.891116Z",
     "iopub.status.idle": "2022-06-27T15:13:48.758717Z",
     "shell.execute_reply": "2022-06-27T15:13:48.757237Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ab2b561b",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "03b46003",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "85f811b5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:48.762173Z",
     "iopub.status.busy": "2022-06-27T15:13:48.761874Z",
     "iopub.status.idle": "2022-06-27T15:13:48.777281Z",
     "shell.execute_reply": "2022-06-27T15:13:48.776717Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "838c807e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-27T15:13:48.780145Z",
     "iopub.status.busy": "2022-06-27T15:13:48.779867Z",
     "iopub.status.idle": "2022-06-27T15:13:50.849266Z",
     "shell.execute_reply": "2022-06-27T15:13:50.848682Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "29e91b60",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
