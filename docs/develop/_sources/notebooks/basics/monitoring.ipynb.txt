{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "04d62a01",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "4efcf5ce",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:39.312763Z",
     "iopub.status.busy": "2022-05-23T11:14:39.312475Z",
     "iopub.status.idle": "2022-05-23T11:14:42.340513Z",
     "shell.execute_reply": "2022-05-23T11:14:42.339871Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-23 11:14:40.219980: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-23 11:14:40.220008: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "19100c7f",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "e1db0871",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.343289Z",
     "iopub.status.busy": "2022-05-23T11:14:42.342851Z",
     "iopub.status.idle": "2022-05-23T11:14:42.346030Z",
     "shell.execute_reply": "2022-05-23T11:14:42.345502Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3cceb578",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "163980a7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.348283Z",
     "iopub.status.busy": "2022-05-23T11:14:42.348036Z",
     "iopub.status.idle": "2022-05-23T11:14:42.350979Z",
     "shell.execute_reply": "2022-05-23T11:14:42.350470Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "66a6c4c4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.353204Z",
     "iopub.status.busy": "2022-05-23T11:14:42.352952Z",
     "iopub.status.idle": "2022-05-23T11:14:42.460341Z",
     "shell.execute_reply": "2022-05-23T11:14:42.459775Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fb28d46f640>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "da546bdb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.462819Z",
     "iopub.status.busy": "2022-05-23T11:14:42.462532Z",
     "iopub.status.idle": "2022-05-23T11:14:42.512165Z",
     "shell.execute_reply": "2022-05-23T11:14:42.511588Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-23 11:14:42.464822: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-23 11:14:42.464850: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-23 11:14:42.464869: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (0ad0ab90cb53): /proc/driver/nvidia/version does not exist\n",
      "2022-05-23 11:14:42.465141: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fb28d4cb2b0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fb28d4cb2b0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "778e7652",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.514710Z",
     "iopub.status.busy": "2022-05-23T11:14:42.514413Z",
     "iopub.status.idle": "2022-05-23T11:14:42.671490Z",
     "shell.execute_reply": "2022-05-23T11:14:42.670896Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b1c90994",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "8f00a9d6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.674164Z",
     "iopub.status.busy": "2022-05-23T11:14:42.673777Z",
     "iopub.status.idle": "2022-05-23T11:14:42.689381Z",
     "shell.execute_reply": "2022-05-23T11:14:42.688792Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5cc02dbf",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "117cb457",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.692401Z",
     "iopub.status.busy": "2022-05-23T11:14:42.692107Z",
     "iopub.status.idle": "2022-05-23T11:14:42.695576Z",
     "shell.execute_reply": "2022-05-23T11:14:42.695062Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "244deebf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:42.697967Z",
     "iopub.status.busy": "2022-05-23T11:14:42.697564Z",
     "iopub.status.idle": "2022-05-23T11:14:50.931484Z",
     "shell.execute_reply": "2022-05-23T11:14:50.930847Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-23 11:14:42.702657: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WARNING:tensorflow:AutoGraph could not transform <bound method ShapeChecker._parse_checks of <gpflow.experimental.check_shapes.checker.ShapeChecker object at 0x7fb28b418df0>> and will run it as-is.\n",
      "Please report this to the TensorFlow team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output.\n",
      "Cause: annotated name 'shape' can't be nonlocal (__autograph_generated_file0pseded2.py, line 72)\n",
      "To silence this warning, decorate the function with @tf.autograph.experimental.do_not_convert\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "WARNING: AutoGraph could not transform <bound method ShapeChecker._parse_checks of <gpflow.experimental.check_shapes.checker.ShapeChecker object at 0x7fb28b418df0>> and will run it as-is.\n",
      "Please report this to the TensorFlow team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output.\n",
      "Cause: annotated name 'shape' can't be nonlocal (__autograph_generated_file0pseded2.py, line 72)\n",
      "To silence this warning, decorate the function with @tf.autograph.experimental.do_not_convert\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ec35974c",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "bbe510b8",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "d53d745a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:50.934658Z",
     "iopub.status.busy": "2022-05-23T11:14:50.934383Z",
     "iopub.status.idle": "2022-05-23T11:14:50.939375Z",
     "shell.execute_reply": "2022-05-23T11:14:50.938867Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c4c0ab65",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "1253e57a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:50.941890Z",
     "iopub.status.busy": "2022-05-23T11:14:50.941624Z",
     "iopub.status.idle": "2022-05-23T11:14:52.826726Z",
     "shell.execute_reply": "2022-05-23T11:14:52.826069Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "11eed921",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ddae8378",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "ea797ec3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:52.829813Z",
     "iopub.status.busy": "2022-05-23T11:14:52.829516Z",
     "iopub.status.idle": "2022-05-23T11:14:52.859973Z",
     "shell.execute_reply": "2022-05-23T11:14:52.859430Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "9fa4cffe",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T11:14:52.862644Z",
     "iopub.status.busy": "2022-05-23T11:14:52.862390Z",
     "iopub.status.idle": "2022-05-23T11:14:54.797534Z",
     "shell.execute_reply": "2022-05-23T11:14:54.796951Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "05db778a",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
