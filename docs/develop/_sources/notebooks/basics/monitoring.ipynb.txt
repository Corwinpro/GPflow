{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "73c540b5",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "93da353e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:54.118044Z",
     "iopub.status.busy": "2022-06-29T10:55:54.117753Z",
     "iopub.status.idle": "2022-06-29T10:55:57.448451Z",
     "shell.execute_reply": "2022-06-29T10:55:57.447817Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-29 10:55:55.009411: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-29 10:55:55.009437: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.inheritance.inherit_check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import reduce_in_tests\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cd38a07b",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "345d5216",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.451877Z",
     "iopub.status.busy": "2022-06-29T10:55:57.451436Z",
     "iopub.status.idle": "2022-06-29T10:55:57.454684Z",
     "shell.execute_reply": "2022-06-29T10:55:57.454167Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d6a59f3b",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "f27221a2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.457130Z",
     "iopub.status.busy": "2022-06-29T10:55:57.456856Z",
     "iopub.status.idle": "2022-06-29T10:55:57.459768Z",
     "shell.execute_reply": "2022-06-29T10:55:57.459277Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = reduce_in_tests(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "2c03bfdd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.462083Z",
     "iopub.status.busy": "2022-06-29T10:55:57.461847Z",
     "iopub.status.idle": "2022-06-29T10:55:57.556488Z",
     "shell.execute_reply": "2022-06-29T10:55:57.555939Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f4a5f90da50>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "8cb8de35",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.559648Z",
     "iopub.status.busy": "2022-06-29T10:55:57.559356Z",
     "iopub.status.idle": "2022-06-29T10:55:57.610404Z",
     "shell.execute_reply": "2022-06-29T10:55:57.609776Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n",
      "2022-06-29 10:55:57.562145: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-29 10:55:57.562179: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-29 10:55:57.562202: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (db43c8a98066): /proc/driver/nvidia/version does not exist\n",
      "2022-06-29 10:55:57.562446: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f4a5f9562f0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f4a5f9562f0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "685da9e3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.613202Z",
     "iopub.status.busy": "2022-06-29T10:55:57.612859Z",
     "iopub.status.idle": "2022-06-29T10:55:57.754842Z",
     "shell.execute_reply": "2022-06-29T10:55:57.754247Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "484a3129",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "d566e33c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.757636Z",
     "iopub.status.busy": "2022-06-29T10:55:57.757343Z",
     "iopub.status.idle": "2022-06-29T10:55:57.773380Z",
     "shell.execute_reply": "2022-06-29T10:55:57.772781Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c392c585",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "ff862e60",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.776084Z",
     "iopub.status.busy": "2022-06-29T10:55:57.775838Z",
     "iopub.status.idle": "2022-06-29T10:55:57.779383Z",
     "shell.execute_reply": "2022-06-29T10:55:57.778852Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "87a6b120",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:55:57.782325Z",
     "iopub.status.busy": "2022-06-29T10:55:57.781808Z",
     "iopub.status.idle": "2022-06-29T10:56:04.177858Z",
     "shell.execute_reply": "2022-06-29T10:56:04.177221Z"
    }
   },
   "outputs": [],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "afffa4c8",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "09d4c78e",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "0413b813",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:56:04.206618Z",
     "iopub.status.busy": "2022-06-29T10:56:04.206323Z",
     "iopub.status.idle": "2022-06-29T10:56:04.210855Z",
     "shell.execute_reply": "2022-06-29T10:56:04.210341Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6f18b290",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "2a2ea400",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:56:04.213347Z",
     "iopub.status.busy": "2022-06-29T10:56:04.213099Z",
     "iopub.status.idle": "2022-06-29T10:56:06.084069Z",
     "shell.execute_reply": "2022-06-29T10:56:06.083357Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "25904132",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "779ea967",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "2b52f14a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:56:06.087425Z",
     "iopub.status.busy": "2022-06-29T10:56:06.087108Z",
     "iopub.status.idle": "2022-06-29T10:56:06.103555Z",
     "shell.execute_reply": "2022-06-29T10:56:06.102864Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "789b8f3e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-29T10:56:06.106563Z",
     "iopub.status.busy": "2022-06-29T10:56:06.106265Z",
     "iopub.status.idle": "2022-06-29T10:56:08.196401Z",
     "shell.execute_reply": "2022-06-29T10:56:08.195814Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889758\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735859e-04, -4.30340709e-04,  3.97830747e-04,  2.26009893e-06,\n",
       "        4.29147212e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005976,   1.74612938,   0.18194306, -15.21875416,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "599d39b2",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
