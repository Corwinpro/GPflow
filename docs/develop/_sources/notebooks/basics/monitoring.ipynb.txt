{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "b01528c9",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "447e7ced",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:05.838288Z",
     "iopub.status.busy": "2022-06-10T09:54:05.837980Z",
     "iopub.status.idle": "2022-06-10T09:54:09.125559Z",
     "shell.execute_reply": "2022-06-10T09:54:09.124928Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-10 09:54:06.781085: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-10 09:54:06.781113: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2e982304",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "1998ba47",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.128813Z",
     "iopub.status.busy": "2022-06-10T09:54:09.128331Z",
     "iopub.status.idle": "2022-06-10T09:54:09.131771Z",
     "shell.execute_reply": "2022-06-10T09:54:09.131208Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b2598c0b",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "0ffb5914",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.134349Z",
     "iopub.status.busy": "2022-06-10T09:54:09.134026Z",
     "iopub.status.idle": "2022-06-10T09:54:09.137123Z",
     "shell.execute_reply": "2022-06-10T09:54:09.136559Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "3b9b2130",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.139539Z",
     "iopub.status.busy": "2022-06-10T09:54:09.139289Z",
     "iopub.status.idle": "2022-06-10T09:54:09.271707Z",
     "shell.execute_reply": "2022-06-10T09:54:09.271148Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fc71ecf47f0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "b034ba7a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.274219Z",
     "iopub.status.busy": "2022-06-10T09:54:09.273951Z",
     "iopub.status.idle": "2022-06-10T09:54:09.323932Z",
     "shell.execute_reply": "2022-06-10T09:54:09.323152Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-10 09:54:09.276145: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-10 09:54:09.276177: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-10 09:54:09.276196: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (97739b7bc232): /proc/driver/nvidia/version does not exist\n",
      "2022-06-10 09:54:09.276456: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fc71eaecfd0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fc71eaecfd0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "91695045",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.326588Z",
     "iopub.status.busy": "2022-06-10T09:54:09.326321Z",
     "iopub.status.idle": "2022-06-10T09:54:09.462311Z",
     "shell.execute_reply": "2022-06-10T09:54:09.461736Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e7c4f33f",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "3fd78189",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.465091Z",
     "iopub.status.busy": "2022-06-10T09:54:09.464818Z",
     "iopub.status.idle": "2022-06-10T09:54:09.620958Z",
     "shell.execute_reply": "2022-06-10T09:54:09.620309Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e65de0fd",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "3d25f1bc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.624058Z",
     "iopub.status.busy": "2022-06-10T09:54:09.623769Z",
     "iopub.status.idle": "2022-06-10T09:54:09.627434Z",
     "shell.execute_reply": "2022-06-10T09:54:09.626885Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "6cd9540a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:09.629716Z",
     "iopub.status.busy": "2022-06-10T09:54:09.629476Z",
     "iopub.status.idle": "2022-06-10T09:54:18.258491Z",
     "shell.execute_reply": "2022-06-10T09:54:18.257800Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-10 09:54:09.634338: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2d1650e2",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5e8edc8b",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "8f7eb028",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:18.302771Z",
     "iopub.status.busy": "2022-06-10T09:54:18.302400Z",
     "iopub.status.idle": "2022-06-10T09:54:18.308422Z",
     "shell.execute_reply": "2022-06-10T09:54:18.307738Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "80f30cc5",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "d3de6001",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:18.311299Z",
     "iopub.status.busy": "2022-06-10T09:54:18.311014Z",
     "iopub.status.idle": "2022-06-10T09:54:20.650111Z",
     "shell.execute_reply": "2022-06-10T09:54:20.649442Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c423a1b9",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c1fce6dd",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "9b7d4603",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:20.653597Z",
     "iopub.status.busy": "2022-06-10T09:54:20.653282Z",
     "iopub.status.idle": "2022-06-10T09:54:20.670299Z",
     "shell.execute_reply": "2022-06-10T09:54:20.669673Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "41d862ee",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T09:54:20.673344Z",
     "iopub.status.busy": "2022-06-10T09:54:20.673043Z",
     "iopub.status.idle": "2022-06-10T09:54:22.500466Z",
     "shell.execute_reply": "2022-06-10T09:54:22.499865Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3feeb430",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
