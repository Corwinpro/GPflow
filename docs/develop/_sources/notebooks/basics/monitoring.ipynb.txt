{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "c195af60",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "278e0857",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:39.284861Z",
     "iopub.status.busy": "2022-04-21T10:50:39.284609Z",
     "iopub.status.idle": "2022-04-21T10:50:42.347322Z",
     "shell.execute_reply": "2022-04-21T10:50:42.346778Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-21 10:50:40.225274: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-04-21 10:50:40.225300: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4790ffb2",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "a1b284be",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.350084Z",
     "iopub.status.busy": "2022-04-21T10:50:42.349863Z",
     "iopub.status.idle": "2022-04-21T10:50:42.352699Z",
     "shell.execute_reply": "2022-04-21T10:50:42.352221Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4028573a",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "c3754be3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.354681Z",
     "iopub.status.busy": "2022-04-21T10:50:42.354508Z",
     "iopub.status.idle": "2022-04-21T10:50:42.357217Z",
     "shell.execute_reply": "2022-04-21T10:50:42.356713Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "b866ff9a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.359091Z",
     "iopub.status.busy": "2022-04-21T10:50:42.358921Z",
     "iopub.status.idle": "2022-04-21T10:50:42.443429Z",
     "shell.execute_reply": "2022-04-21T10:50:42.442942Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f172f6ace80>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "141a6fe1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.445595Z",
     "iopub.status.busy": "2022-04-21T10:50:42.445388Z",
     "iopub.status.idle": "2022-04-21T10:50:42.493746Z",
     "shell.execute_reply": "2022-04-21T10:50:42.493251Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-21 10:50:42.447497: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-04-21 10:50:42.447528: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-04-21 10:50:42.447547: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (4d3c2b4e3577): /proc/driver/nvidia/version does not exist\n",
      "2022-04-21 10:50:42.447793: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f172f6ecf40&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f172f6ecf40>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "7716f26f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.496082Z",
     "iopub.status.busy": "2022-04-21T10:50:42.495875Z",
     "iopub.status.idle": "2022-04-21T10:50:42.640656Z",
     "shell.execute_reply": "2022-04-21T10:50:42.640193Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c331c6cf",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "5f3af3cb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.644883Z",
     "iopub.status.busy": "2022-04-21T10:50:42.644470Z",
     "iopub.status.idle": "2022-04-21T10:50:42.659419Z",
     "shell.execute_reply": "2022-04-21T10:50:42.658939Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1166a3c6",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "9f06bc0a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.661828Z",
     "iopub.status.busy": "2022-04-21T10:50:42.661621Z",
     "iopub.status.idle": "2022-04-21T10:50:42.664981Z",
     "shell.execute_reply": "2022-04-21T10:50:42.664504Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "804239f7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:42.667119Z",
     "iopub.status.busy": "2022-04-21T10:50:42.666942Z",
     "iopub.status.idle": "2022-04-21T10:50:48.566857Z",
     "shell.execute_reply": "2022-04-21T10:50:48.566299Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-04-21 10:50:42.671736: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e2f864b4",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9c9aa46a",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "82d391d6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:48.569656Z",
     "iopub.status.busy": "2022-04-21T10:50:48.569437Z",
     "iopub.status.idle": "2022-04-21T10:50:48.574280Z",
     "shell.execute_reply": "2022-04-21T10:50:48.573851Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "69feab81",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "2111bd27",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:48.576550Z",
     "iopub.status.busy": "2022-04-21T10:50:48.576349Z",
     "iopub.status.idle": "2022-04-21T10:50:50.624874Z",
     "shell.execute_reply": "2022-04-21T10:50:50.624174Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "496c5684",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5d30c840",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "c018906b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:50.627925Z",
     "iopub.status.busy": "2022-04-21T10:50:50.627680Z",
     "iopub.status.idle": "2022-04-21T10:50:50.647791Z",
     "shell.execute_reply": "2022-04-21T10:50:50.647186Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "33ff0d0b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-21T10:50:50.650589Z",
     "iopub.status.busy": "2022-04-21T10:50:50.650353Z",
     "iopub.status.idle": "2022-04-21T10:50:52.722750Z",
     "shell.execute_reply": "2022-04-21T10:50:52.722312Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "caa6d762",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
