{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "3c0814a8",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3dfaab53",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:35.074589Z",
     "iopub.status.busy": "2022-06-07T09:15:35.074275Z",
     "iopub.status.idle": "2022-06-07T09:15:38.407428Z",
     "shell.execute_reply": "2022-06-07T09:15:38.406613Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-07 09:15:36.064553: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-07 09:15:36.064581: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6dac8482",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "2069d8f7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.410478Z",
     "iopub.status.busy": "2022-06-07T09:15:38.410027Z",
     "iopub.status.idle": "2022-06-07T09:15:38.413624Z",
     "shell.execute_reply": "2022-06-07T09:15:38.412924Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2a32b37b",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "bd919ab0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.416073Z",
     "iopub.status.busy": "2022-06-07T09:15:38.415823Z",
     "iopub.status.idle": "2022-06-07T09:15:38.418809Z",
     "shell.execute_reply": "2022-06-07T09:15:38.418227Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "7a86e327",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.421098Z",
     "iopub.status.busy": "2022-06-07T09:15:38.420864Z",
     "iopub.status.idle": "2022-06-07T09:15:38.542955Z",
     "shell.execute_reply": "2022-06-07T09:15:38.542316Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fc527a4dab0>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "e81c30f8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.545831Z",
     "iopub.status.busy": "2022-06-07T09:15:38.545518Z",
     "iopub.status.idle": "2022-06-07T09:15:38.596580Z",
     "shell.execute_reply": "2022-06-07T09:15:38.595775Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-07 09:15:38.547881: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-07 09:15:38.547913: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-07 09:15:38.547932: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (bb5e1c5f504d): /proc/driver/nvidia/version does not exist\n",
      "2022-06-07 09:15:38.548192: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fc527aae320&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fc527aae320>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "7344fa3a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.599577Z",
     "iopub.status.busy": "2022-06-07T09:15:38.599292Z",
     "iopub.status.idle": "2022-06-07T09:15:38.753545Z",
     "shell.execute_reply": "2022-06-07T09:15:38.752687Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eea89762",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "a26e8281",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.756476Z",
     "iopub.status.busy": "2022-06-07T09:15:38.756170Z",
     "iopub.status.idle": "2022-06-07T09:15:38.772406Z",
     "shell.execute_reply": "2022-06-07T09:15:38.771813Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "97845e92",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "fa5add74",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.775526Z",
     "iopub.status.busy": "2022-06-07T09:15:38.775236Z",
     "iopub.status.idle": "2022-06-07T09:15:38.779021Z",
     "shell.execute_reply": "2022-06-07T09:15:38.778449Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "a9bb631f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:38.781520Z",
     "iopub.status.busy": "2022-06-07T09:15:38.781255Z",
     "iopub.status.idle": "2022-06-07T09:15:47.643040Z",
     "shell.execute_reply": "2022-06-07T09:15:47.642356Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-07 09:15:38.786117: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "35d983f9",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "77c8d894",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "1892e533",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:47.687708Z",
     "iopub.status.busy": "2022-06-07T09:15:47.687301Z",
     "iopub.status.idle": "2022-06-07T09:15:47.692805Z",
     "shell.execute_reply": "2022-06-07T09:15:47.692245Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "32ebc763",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "0377469a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:47.695975Z",
     "iopub.status.busy": "2022-06-07T09:15:47.695689Z",
     "iopub.status.idle": "2022-06-07T09:15:50.075348Z",
     "shell.execute_reply": "2022-06-07T09:15:50.074627Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b59565ea",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "24990475",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "9b73ad7c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:50.078546Z",
     "iopub.status.busy": "2022-06-07T09:15:50.078247Z",
     "iopub.status.idle": "2022-06-07T09:15:50.095065Z",
     "shell.execute_reply": "2022-06-07T09:15:50.094447Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "cdaace74",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-07T09:15:50.097940Z",
     "iopub.status.busy": "2022-06-07T09:15:50.097671Z",
     "iopub.status.idle": "2022-06-07T09:15:52.087470Z",
     "shell.execute_reply": "2022-06-07T09:15:52.086902Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "d3cdc632",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
