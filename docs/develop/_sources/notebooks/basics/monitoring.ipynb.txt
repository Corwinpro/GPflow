{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "2762378a",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "bc577cde",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:35.795557Z",
     "iopub.status.busy": "2022-06-10T06:52:35.795268Z",
     "iopub.status.idle": "2022-06-10T06:52:38.972374Z",
     "shell.execute_reply": "2022-06-10T06:52:38.971621Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-10 06:52:36.759730: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-06-10 06:52:36.759759: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eec4e2f8",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "20c6133e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:38.975421Z",
     "iopub.status.busy": "2022-06-10T06:52:38.974967Z",
     "iopub.status.idle": "2022-06-10T06:52:38.978573Z",
     "shell.execute_reply": "2022-06-10T06:52:38.977898Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dd3843e5",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "6fc91816",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:38.981255Z",
     "iopub.status.busy": "2022-06-10T06:52:38.980981Z",
     "iopub.status.idle": "2022-06-10T06:52:38.984056Z",
     "shell.execute_reply": "2022-06-10T06:52:38.983480Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "66b396ab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:38.986478Z",
     "iopub.status.busy": "2022-06-10T06:52:38.986222Z",
     "iopub.status.idle": "2022-06-10T06:52:39.086966Z",
     "shell.execute_reply": "2022-06-10T06:52:39.086248Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7f8a8dff5b10>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "1b7d1c7a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:39.089795Z",
     "iopub.status.busy": "2022-06-10T06:52:39.089498Z",
     "iopub.status.idle": "2022-06-10T06:52:39.142230Z",
     "shell.execute_reply": "2022-06-10T06:52:39.141579Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-10 06:52:39.091920: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-06-10 06:52:39.091947: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-06-10 06:52:39.091966: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (0091ed1183cb): /proc/driver/nvidia/version does not exist\n",
      "2022-06-10 06:52:39.092265: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7f8a8e055f00&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7f8a8e055f00>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "f7c14ff5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:39.144825Z",
     "iopub.status.busy": "2022-06-10T06:52:39.144531Z",
     "iopub.status.idle": "2022-06-10T06:52:39.297401Z",
     "shell.execute_reply": "2022-06-10T06:52:39.296750Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fbffd3cf",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "ddb92957",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:39.300140Z",
     "iopub.status.busy": "2022-06-10T06:52:39.299800Z",
     "iopub.status.idle": "2022-06-10T06:52:39.316751Z",
     "shell.execute_reply": "2022-06-10T06:52:39.316112Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "458e66c6",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "8f9ed3d8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:39.319762Z",
     "iopub.status.busy": "2022-06-10T06:52:39.319466Z",
     "iopub.status.idle": "2022-06-10T06:52:39.323068Z",
     "shell.execute_reply": "2022-06-10T06:52:39.322536Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "ad0a98a4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:39.325656Z",
     "iopub.status.busy": "2022-06-10T06:52:39.325409Z",
     "iopub.status.idle": "2022-06-10T06:52:48.062604Z",
     "shell.execute_reply": "2022-06-10T06:52:48.061903Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-06-10 06:52:39.330175: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f5e18c45",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cd0ab81b",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "1198e4fb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:48.086486Z",
     "iopub.status.busy": "2022-06-10T06:52:48.086032Z",
     "iopub.status.idle": "2022-06-10T06:52:48.093274Z",
     "shell.execute_reply": "2022-06-10T06:52:48.092574Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "57caa839",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "b907f874",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:48.096409Z",
     "iopub.status.busy": "2022-06-10T06:52:48.095997Z",
     "iopub.status.idle": "2022-06-10T06:52:50.303472Z",
     "shell.execute_reply": "2022-06-10T06:52:50.302778Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1e086d19",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3d273a2b",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "a14fb2c8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:50.306748Z",
     "iopub.status.busy": "2022-06-10T06:52:50.306444Z",
     "iopub.status.idle": "2022-06-10T06:52:50.323488Z",
     "shell.execute_reply": "2022-06-10T06:52:50.322826Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "3e2fac9c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-10T06:52:50.326222Z",
     "iopub.status.busy": "2022-06-10T06:52:50.325947Z",
     "iopub.status.idle": "2022-06-10T06:52:52.321246Z",
     "shell.execute_reply": "2022-06-10T06:52:52.320496Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "be07ca41",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
