{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "90f28be4",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "df4ac5be",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:09.679211Z",
     "iopub.status.busy": "2022-05-23T13:22:09.678903Z",
     "iopub.status.idle": "2022-05-23T13:22:12.823035Z",
     "shell.execute_reply": "2022-05-23T13:22:12.822304Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-23 13:22:10.618030: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-05-23 13:22:10.618061: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.decorator.check_shapes which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "205d58cc",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "544e2493",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:12.825943Z",
     "iopub.status.busy": "2022-05-23T13:22:12.825467Z",
     "iopub.status.idle": "2022-05-23T13:22:12.828870Z",
     "shell.execute_reply": "2022-05-23T13:22:12.828256Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "91979cc4",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "a76b81b9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:12.833393Z",
     "iopub.status.busy": "2022-05-23T13:22:12.833087Z",
     "iopub.status.idle": "2022-05-23T13:22:12.836343Z",
     "shell.execute_reply": "2022-05-23T13:22:12.835763Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "82257de4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:12.838852Z",
     "iopub.status.busy": "2022-05-23T13:22:12.838578Z",
     "iopub.status.idle": "2022-05-23T13:22:12.936799Z",
     "shell.execute_reply": "2022-05-23T13:22:12.935927Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7faeb6b53820>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "222634b5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:12.940237Z",
     "iopub.status.busy": "2022-05-23T13:22:12.939898Z",
     "iopub.status.idle": "2022-05-23T13:22:12.992442Z",
     "shell.execute_reply": "2022-05-23T13:22:12.991571Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-23 13:22:12.942319: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-05-23 13:22:12.942361: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-05-23 13:22:12.942385: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (4b1aebcab215): /proc/driver/nvidia/version does not exist\n",
      "2022-05-23 13:22:12.942668: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n",
      "/home/circleci/project/gpflow/experimental/utils.py:42: UserWarning: You're calling gpflow.experimental.check_shapes.checker.ShapeChecker.__init__ which is considered *experimental*. Expect: breaking changes, poor documentation, and bugs.\n",
      "  warn(\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7faeb6bafee0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7faeb6bafee0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "ebcff4a5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:12.995469Z",
     "iopub.status.busy": "2022-05-23T13:22:12.995157Z",
     "iopub.status.idle": "2022-05-23T13:22:13.151021Z",
     "shell.execute_reply": "2022-05-23T13:22:13.150400Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9b15d951",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "4493af12",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:13.153567Z",
     "iopub.status.busy": "2022-05-23T13:22:13.153278Z",
     "iopub.status.idle": "2022-05-23T13:22:13.173678Z",
     "shell.execute_reply": "2022-05-23T13:22:13.172972Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ab0b791d",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "18cda3d0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:13.176682Z",
     "iopub.status.busy": "2022-05-23T13:22:13.176373Z",
     "iopub.status.idle": "2022-05-23T13:22:13.180027Z",
     "shell.execute_reply": "2022-05-23T13:22:13.179430Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "cad70a30",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:13.182491Z",
     "iopub.status.busy": "2022-05-23T13:22:13.182244Z",
     "iopub.status.idle": "2022-05-23T13:22:21.525187Z",
     "shell.execute_reply": "2022-05-23T13:22:21.524531Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-05-23 13:22:13.187227: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0eabe478",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "54b802e6",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "bd32ed32",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:21.528265Z",
     "iopub.status.busy": "2022-05-23T13:22:21.528003Z",
     "iopub.status.idle": "2022-05-23T13:22:21.533105Z",
     "shell.execute_reply": "2022-05-23T13:22:21.532589Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6bedbc31",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "23753cbf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:21.535305Z",
     "iopub.status.busy": "2022-05-23T13:22:21.535066Z",
     "iopub.status.idle": "2022-05-23T13:22:23.658083Z",
     "shell.execute_reply": "2022-05-23T13:22:23.657421Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8fb896f7",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "af4b120d",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "5706762a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:23.661419Z",
     "iopub.status.busy": "2022-05-23T13:22:23.661136Z",
     "iopub.status.idle": "2022-05-23T13:22:23.677338Z",
     "shell.execute_reply": "2022-05-23T13:22:23.676805Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "53a1753b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-23T13:22:23.679971Z",
     "iopub.status.busy": "2022-05-23T13:22:23.679682Z",
     "iopub.status.idle": "2022-05-23T13:22:25.519437Z",
     "shell.execute_reply": "2022-05-23T13:22:25.518837Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "affaaeeb",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
