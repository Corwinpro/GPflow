{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "984bfe77",
   "metadata": {},
   "source": [
    "# Monitoring Optimisation\n",
    "\n",
    "In this notebook we cover how to monitor the model and certain metrics during optimisation.\n",
    "\n",
    "## Setup"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "02618c85",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:35.717577Z",
     "iopub.status.busy": "2022-03-24T10:55:35.717359Z",
     "iopub.status.idle": "2022-03-24T10:55:38.494397Z",
     "shell.execute_reply": "2022-03-24T10:55:38.493900Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-03-24 10:55:36.608308: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcudart.so.11.0'; dlerror: libcudart.so.11.0: cannot open shared object file: No such file or directory\n",
      "2022-03-24 10:55:36.608336: I tensorflow/stream_executor/cuda/cudart_stub.cc:29] Ignore above cudart dlerror if you do not have a GPU set up on your machine.\n"
     ]
    }
   ],
   "source": [
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import tensorflow as tf\n",
    "\n",
    "import gpflow\n",
    "from gpflow.ci_utils import ci_niter\n",
    "\n",
    "np.random.seed(0)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b63f4079",
   "metadata": {},
   "source": [
    "The monitoring functionality lives in `gpflow.monitor`.\n",
    "For now, we import `ModelToTensorBoard`, `ImageToTensorBoard`, `ScalarToTensorBoard` monitoring tasks and `MonitorTaskGroup` and `Monitor`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "0b568824",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.498067Z",
     "iopub.status.busy": "2022-03-24T10:55:38.497865Z",
     "iopub.status.idle": "2022-03-24T10:55:38.500617Z",
     "shell.execute_reply": "2022-03-24T10:55:38.500233Z"
    }
   },
   "outputs": [],
   "source": [
    "from gpflow.monitor import (\n",
    "    ImageToTensorBoard,\n",
    "    ModelToTensorBoard,\n",
    "    Monitor,\n",
    "    MonitorTaskGroup,\n",
    "    ScalarToTensorBoard,\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6a61ee13",
   "metadata": {},
   "source": [
    "## Set up data and model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "8ac668c4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.503272Z",
     "iopub.status.busy": "2022-03-24T10:55:38.503088Z",
     "iopub.status.idle": "2022-03-24T10:55:38.505464Z",
     "shell.execute_reply": "2022-03-24T10:55:38.505094Z"
    }
   },
   "outputs": [],
   "source": [
    "# Define some configuration constants.\n",
    "\n",
    "num_data = 100\n",
    "noise_std = 0.1\n",
    "optimisation_steps = ci_niter(100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "54442626",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.507955Z",
     "iopub.status.busy": "2022-03-24T10:55:38.507778Z",
     "iopub.status.idle": "2022-03-24T10:55:38.596438Z",
     "shell.execute_reply": "2022-03-24T10:55:38.596029Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[<matplotlib.lines.Line2D at 0x7fc3648ee290>]"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Create dummy data.\n",
    "\n",
    "X = np.random.randn(num_data, 1)  # [N, 2]\n",
    "Y = np.sin(X) + 0.5 * np.cos(X) + np.random.randn(*X.shape) * noise_std  # [N, 1]\n",
    "plt.plot(X, Y, \"o\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "5613b606",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.598625Z",
     "iopub.status.busy": "2022-03-24T10:55:38.598424Z",
     "iopub.status.idle": "2022-03-24T10:55:38.644197Z",
     "shell.execute_reply": "2022-03-24T10:55:38.643795Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-03-24 10:55:38.600434: W tensorflow/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory\n",
      "2022-03-24 10:55:38.600461: W tensorflow/stream_executor/cuda/cuda_driver.cc:269] failed call to cuInit: UNKNOWN ERROR (303)\n",
      "2022-03-24 10:55:38.600481: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (f5cda27cc66e): /proc/driver/nvidia/version does not exist\n",
      "2022-03-24 10:55:38.600758: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA\n",
      "To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "&lt;gpflow.models.gpr.GPR object at 0x7fc36274dae0&gt;\n",
       "<table>\n",
       "<thead>\n",
       "<tr><th>name                              </th><th>class    </th><th>transform       </th><th>prior  </th><th>trainable  </th><th>shape  </th><th>dtype  </th><th>value               </th></tr>\n",
       "</thead>\n",
       "<tbody>\n",
       "<tr><td>GPR.kernel.kernels[0].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[0].lengthscales</td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>(2,)   </td><td>float64</td><td>[1. 2.]             </td></tr>\n",
       "<tr><td>GPR.kernel.kernels[1].variance    </td><td>Parameter</td><td>Softplus        </td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>1.0                 </td></tr>\n",
       "<tr><td>GPR.likelihood.variance           </td><td>Parameter</td><td>Softplus + Shift</td><td>       </td><td>True       </td><td>()     </td><td>float64</td><td>0.009999999999999998</td></tr>\n",
       "</tbody>\n",
       "</table>"
      ],
      "text/plain": [
       "<gpflow.models.gpr.GPR object at 0x7fc36274dae0>\n",
       "╒════════════════════════════════════╤═══════════╤══════════════════╤═════════╤═════════════╤═════════╤═════════╤══════════════════════╕\n",
       "│ name                               │ class     │ transform        │ prior   │ trainable   │ shape   │ dtype   │ value                │\n",
       "╞════════════════════════════════════╪═══════════╪══════════════════╪═════════╪═════════════╪═════════╪═════════╪══════════════════════╡\n",
       "│ GPR.kernel.kernels[0].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[0].lengthscales │ Parameter │ Softplus         │         │ True        │ (2,)    │ float64 │ [1. 2.]              │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.kernel.kernels[1].variance     │ Parameter │ Softplus         │         │ True        │ ()      │ float64 │ 1.0                  │\n",
       "├────────────────────────────────────┼───────────┼──────────────────┼─────────┼─────────────┼─────────┼─────────┼──────────────────────┤\n",
       "│ GPR.likelihood.variance            │ Parameter │ Softplus + Shift │         │ True        │ ()      │ float64 │ 0.009999999999999998 │\n",
       "╘════════════════════════════════════╧═══════════╧══════════════════╧═════════╧═════════════╧═════════╧═════════╧══════════════════════╛"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Set up model and print\n",
    "\n",
    "kernel = gpflow.kernels.SquaredExponential(lengthscales=[1.0, 2.0]) + gpflow.kernels.Linear()\n",
    "model = gpflow.models.GPR((X, Y), kernel, noise_variance=noise_std ** 2)\n",
    "model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "15cc9079",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.646398Z",
     "iopub.status.busy": "2022-03-24T10:55:38.646209Z",
     "iopub.status.idle": "2022-03-24T10:55:38.773098Z",
     "shell.execute_reply": "2022-03-24T10:55:38.772685Z"
    }
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# We define a function that plots the model's prediction (in the form of samples) together with the data.\n",
    "# Importantly, this function has no other argument than `fig: matplotlib.figure.Figure` and `ax: matplotlib.figure.Axes`.\n",
    "\n",
    "\n",
    "def plot_prediction(fig, ax):\n",
    "    Xnew = np.linspace(X.min() - 0.5, X.max() + 0.5, 100).reshape(-1, 1)\n",
    "    Ypred = model.predict_f_samples(Xnew, full_cov=True, num_samples=20)\n",
    "    ax.plot(Xnew.flatten(), np.squeeze(Ypred).T, \"C1\", alpha=0.2)\n",
    "    ax.plot(X, Y, \"o\")\n",
    "\n",
    "\n",
    "# Let's check if the function does the desired plotting\n",
    "fig = plt.figure()\n",
    "ax = fig.subplots()\n",
    "plot_prediction(fig, ax)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f4175ba2",
   "metadata": {},
   "source": [
    "## Set up monitoring tasks\n",
    "\n",
    "We now define the `MonitorTask`s that will be executed during the optimisation.\n",
    "For this tutorial we set up three tasks:\n",
    "- `ModelToTensorBoard`: writes the models hyper-parameters such as `likelihood.variance` and `kernel.lengthscales` to a TensorBoard.\n",
    "- `ImageToTensorBoard`: writes custom matplotlib images to a TensorBoard.\n",
    "- `ScalarToTensorBoard`: writes any scalar value to a TensorBoard. Here, we use it to write the model's training objective."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "872e6b16",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.775297Z",
     "iopub.status.busy": "2022-03-24T10:55:38.775099Z",
     "iopub.status.idle": "2022-03-24T10:55:38.904066Z",
     "shell.execute_reply": "2022-03-24T10:55:38.903606Z"
    }
   },
   "outputs": [],
   "source": [
    "log_dir = \"logs\"  # Directory where TensorBoard files will be written.\n",
    "model_task = ModelToTensorBoard(log_dir, model)\n",
    "image_task = ImageToTensorBoard(log_dir, plot_prediction, \"image_samples\")\n",
    "lml_task = ScalarToTensorBoard(log_dir, lambda: model.training_loss(), \"training_objective\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6fb34b30",
   "metadata": {},
   "source": [
    "We now group the tasks in a set of fast and slow tasks and pass them to the monitor.\n",
    "This allows us to execute the groups at a different frequency."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "6d85f977",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.906670Z",
     "iopub.status.busy": "2022-03-24T10:55:38.906478Z",
     "iopub.status.idle": "2022-03-24T10:55:38.909540Z",
     "shell.execute_reply": "2022-03-24T10:55:38.909156Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "# Plotting tasks can be quite slow. We want to run them less frequently.\n",
    "# We group them in a `MonitorTaskGroup` and set the period to 5.\n",
    "slow_tasks = MonitorTaskGroup(image_task, period=5)\n",
    "\n",
    "# The other tasks are fast. We run them at each iteration of the optimisation.\n",
    "fast_tasks = MonitorTaskGroup([model_task, lml_task], period=1)\n",
    "\n",
    "# Both groups are passed to the monitor.\n",
    "# `slow_tasks` will be run five times less frequently than `fast_tasks`.\n",
    "monitor = Monitor(fast_tasks, slow_tasks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "3766c8c9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:38.911326Z",
     "iopub.status.busy": "2022-03-24T10:55:38.911164Z",
     "iopub.status.idle": "2022-03-24T10:55:44.894304Z",
     "shell.execute_reply": "2022-03-24T10:55:44.893795Z"
    }
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2022-03-24 10:55:38.915074: W tensorflow/python/util/util.cc:368] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.\n"
     ]
    }
   ],
   "source": [
    "training_loss = model.training_loss_closure(\n",
    "    compile=True\n",
    ")  # compile=True (default): compiles using tf.function\n",
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "for step in range(optimisation_steps):\n",
    "    opt.minimize(training_loss, model.trainable_variables)\n",
    "    monitor(step)  # <-- run the monitoring"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1f216340",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "TensorBoard is accessible through the browser, after launching the server by running `tensorboard --logdir ${logdir}`.\n",
    "See the [TensorFlow documentation on TensorBoard](https://www.tensorflow.org/tensorboard/get_started) for more information."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "40bd59e6",
   "metadata": {},
   "source": [
    "### For optimal performance, we can also wrap the monitor call inside `tf.function`:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "6dcb0581",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:44.897796Z",
     "iopub.status.busy": "2022-03-24T10:55:44.897560Z",
     "iopub.status.idle": "2022-03-24T10:55:44.902281Z",
     "shell.execute_reply": "2022-03-24T10:55:44.901869Z"
    },
    "lines_to_next_cell": 2
   },
   "outputs": [],
   "source": [
    "opt = tf.optimizers.Adam()\n",
    "\n",
    "log_dir_compiled = f\"{log_dir}/compiled\"\n",
    "model_task = ModelToTensorBoard(log_dir_compiled, model)\n",
    "lml_task = ScalarToTensorBoard(\n",
    "    log_dir_compiled, lambda: model.training_loss(), \"training_objective\"\n",
    ")\n",
    "# Note that the `ImageToTensorBoard` task cannot be compiled, and is omitted from the monitoring\n",
    "monitor = Monitor(MonitorTaskGroup([model_task, lml_task]))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4136ce3c",
   "metadata": {
    "lines_to_next_cell": 2
   },
   "source": [
    "In the optimisation loop below we use `tf.range` (rather than Python's built-in range) to avoid re-tracing the `step` function each time."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "1c6d6e78",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:44.904843Z",
     "iopub.status.busy": "2022-03-24T10:55:44.904661Z",
     "iopub.status.idle": "2022-03-24T10:55:46.774086Z",
     "shell.execute_reply": "2022-03-24T10:55:46.773503Z"
    }
   },
   "outputs": [],
   "source": [
    "@tf.function\n",
    "def step(i):\n",
    "    opt.minimize(model.training_loss, model.trainable_variables)\n",
    "    monitor(i)\n",
    "\n",
    "\n",
    "# Notice the tf.range\n",
    "for i in tf.range(optimisation_steps):\n",
    "    step(i)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "84c44fee",
   "metadata": {},
   "source": [
    "When opening TensorBoard, you may need to use the command `tensorboard --logdir . --reload_multifile=true`, as multiple `FileWriter` objects are used."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "92c27932",
   "metadata": {},
   "source": [
    "### Scipy Optimization monitoring\n",
    "\n",
    "Note that if you want to use the `Scipy` optimizer provided by GPflow, and want to monitor the training progress, then you need to simply replace\n",
    "the optimization loop with a single call to its `minimize` method and pass in the monitor as a `step_callback` keyword argument:\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "8bff8977",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:46.776942Z",
     "iopub.status.busy": "2022-03-24T10:55:46.776706Z",
     "iopub.status.idle": "2022-03-24T10:55:46.793007Z",
     "shell.execute_reply": "2022-03-24T10:55:46.792570Z"
    }
   },
   "outputs": [],
   "source": [
    "opt = gpflow.optimizers.Scipy()\n",
    "\n",
    "log_dir_scipy = f\"{log_dir}/scipy\"\n",
    "model_task = ModelToTensorBoard(log_dir_scipy, model)\n",
    "lml_task = ScalarToTensorBoard(log_dir_scipy, lambda: model.training_loss(), \"training_objective\")\n",
    "image_task = ImageToTensorBoard(log_dir_scipy, plot_prediction, \"image_samples\")\n",
    "\n",
    "monitor = Monitor(\n",
    "    MonitorTaskGroup([model_task, lml_task], period=1), MonitorTaskGroup(image_task, period=5)\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "0e2908e5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-03-24T10:55:46.795491Z",
     "iopub.status.busy": "2022-03-24T10:55:46.795273Z",
     "iopub.status.idle": "2022-03-24T10:55:48.881579Z",
     "shell.execute_reply": "2022-03-24T10:55:48.881019Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "      fun: -69.68099880889753\n",
       " hess_inv: <5x5 LbfgsInvHessProduct with dtype=float64>\n",
       "      jac: array([-2.96735825e-04, -4.30340661e-04,  3.97830673e-04,  2.26009904e-06,\n",
       "        4.29147152e-04])\n",
       "  message: 'CONVERGENCE: REL_REDUCTION_OF_F_<=_FACTR*EPSMCH'\n",
       "     nfev: 37\n",
       "      nit: 28\n",
       "     njev: 37\n",
       "   status: 0\n",
       "  success: True\n",
       "        x: array([  2.07005977,   1.74612938,   0.18194306, -15.21875411,\n",
       "        -4.53840856])"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "opt.minimize(training_loss, model.trainable_variables, step_callback=monitor)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6e10cfc1",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "jupytext": {
   "formats": "ipynb,.pct.py:percent"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
